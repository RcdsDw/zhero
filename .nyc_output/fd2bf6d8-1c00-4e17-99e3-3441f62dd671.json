{"/usr/src/app/src/models/user/user.ts":{"path":"/usr/src/app/src/models/user/user.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"4":{"start":{"line":7,"column":19},"end":{"line":7,"column":38}},"5":{"start":{"line":8,"column":21},"end":{"line":8,"column":44}},"6":{"start":{"line":9,"column":21},"end":{"line":9,"column":44}},"7":{"start":{"line":10,"column":15},"end":{"line":10,"column":32}},"8":{"start":{"line":11,"column":22},"end":{"line":11,"column":80}},"9":{"start":{"line":12,"column":19},"end":{"line":12,"column":40}},"10":{"start":{"line":13,"column":20},"end":{"line":13,"column":42}},"11":{"start":{"line":14,"column":16},"end":{"line":14,"column":34}},"12":{"start":{"line":15,"column":15},"end":{"line":15,"column":38}},"13":{"start":{"line":16,"column":23},"end":{"line":16,"column":82}},"14":{"start":{"line":17,"column":19},"end":{"line":65,"column":2}},"15":{"start":{"line":31,"column":24},"end":{"line":31,"column":26}},"16":{"start":{"line":36,"column":24},"end":{"line":36,"column":26}},"17":{"start":{"line":46,"column":24},"end":{"line":46,"column":26}},"18":{"start":{"line":51,"column":24},"end":{"line":51,"column":26}},"19":{"start":{"line":56,"column":24},"end":{"line":56,"column":26}},"20":{"start":{"line":61,"column":24},"end":{"line":61,"column":26}},"21":{"start":{"line":66,"column":0},"end":{"line":70,"column":2}},"22":{"start":{"line":67,"column":4},"end":{"line":69,"column":7}},"23":{"start":{"line":71,"column":0},"end":{"line":87,"column":2}},"24":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"25":{"start":{"line":73,"column":8},"end":{"line":73,"column":104}},"26":{"start":{"line":75,"column":17},"end":{"line":75,"column":35}},"27":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"28":{"start":{"line":77,"column":8},"end":{"line":77,"column":79}},"29":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"30":{"start":{"line":80,"column":8},"end":{"line":80,"column":88}},"31":{"start":{"line":82,"column":4},"end":{"line":82,"column":36}},"32":{"start":{"line":83,"column":4},"end":{"line":83,"column":33}},"33":{"start":{"line":84,"column":4},"end":{"line":84,"column":28}},"34":{"start":{"line":85,"column":4},"end":{"line":85,"column":22}},"35":{"start":{"line":86,"column":4},"end":{"line":86,"column":47}},"36":{"start":{"line":88,"column":0},"end":{"line":97,"column":2}},"37":{"start":{"line":89,"column":17},"end":{"line":89,"column":40}},"38":{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},"39":{"start":{"line":91,"column":8},"end":{"line":91,"column":74}},"40":{"start":{"line":93,"column":4},"end":{"line":93,"column":38}},"41":{"start":{"line":94,"column":4},"end":{"line":94,"column":37}},"42":{"start":{"line":95,"column":4},"end":{"line":95,"column":22}},"43":{"start":{"line":96,"column":4},"end":{"line":96,"column":27}},"44":{"start":{"line":98,"column":0},"end":{"line":113,"column":2}},"45":{"start":{"line":99,"column":26},"end":{"line":99,"column":49}},"46":{"start":{"line":100,"column":22},"end":{"line":100,"column":66}},"47":{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},"48":{"start":{"line":102,"column":8},"end":{"line":102,"column":15}},"49":{"start":{"line":104,"column":4},"end":{"line":109,"column":5}},"50":{"start":{"line":105,"column":8},"end":{"line":105,"column":42}},"51":{"start":{"line":108,"column":8},"end":{"line":108,"column":44}},"52":{"start":{"line":110,"column":4},"end":{"line":110,"column":40}},"53":{"start":{"line":111,"column":4},"end":{"line":111,"column":47}},"54":{"start":{"line":112,"column":4},"end":{"line":112,"column":22}},"55":{"start":{"line":114,"column":0},"end":{"line":116,"column":2}},"56":{"start":{"line":115,"column":4},"end":{"line":115,"column":64}},"57":{"start":{"line":117,"column":0},"end":{"line":120,"column":2}},"58":{"start":{"line":118,"column":17},"end":{"line":118,"column":60}},"59":{"start":{"line":119,"column":4},"end":{"line":119,"column":16}},"60":{"start":{"line":121,"column":18},"end":{"line":121,"column":59}},"61":{"start":{"line":122,"column":0},"end":{"line":122,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":31,"column":17},"end":{"line":31,"column":18}},"loc":{"start":{"line":31,"column":24},"end":{"line":31,"column":26}},"line":31},"2":{"name":"(anonymous_2)","decl":{"start":{"line":36,"column":17},"end":{"line":36,"column":18}},"loc":{"start":{"line":36,"column":24},"end":{"line":36,"column":26}},"line":36},"3":{"name":"(anonymous_3)","decl":{"start":{"line":46,"column":17},"end":{"line":46,"column":18}},"loc":{"start":{"line":46,"column":24},"end":{"line":46,"column":26}},"line":46},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":17},"end":{"line":51,"column":18}},"loc":{"start":{"line":51,"column":24},"end":{"line":51,"column":26}},"line":51},"5":{"name":"(anonymous_5)","decl":{"start":{"line":56,"column":17},"end":{"line":56,"column":18}},"loc":{"start":{"line":56,"column":24},"end":{"line":56,"column":26}},"line":56},"6":{"name":"(anonymous_6)","decl":{"start":{"line":61,"column":17},"end":{"line":61,"column":18}},"loc":{"start":{"line":61,"column":24},"end":{"line":61,"column":26}},"line":61},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":39},"end":{"line":66,"column":40}},"loc":{"start":{"line":66,"column":55},"end":{"line":70,"column":1}},"line":66},"8":{"name":"(anonymous_8)","decl":{"start":{"line":71,"column":29},"end":{"line":71,"column":30}},"loc":{"start":{"line":71,"column":48},"end":{"line":87,"column":1}},"line":71},"9":{"name":"(anonymous_9)","decl":{"start":{"line":88,"column":30},"end":{"line":88,"column":31}},"loc":{"start":{"line":88,"column":49},"end":{"line":97,"column":1}},"line":88},"10":{"name":"(anonymous_10)","decl":{"start":{"line":98,"column":31},"end":{"line":98,"column":32}},"loc":{"start":{"line":98,"column":50},"end":{"line":113,"column":1}},"line":98},"11":{"name":"(anonymous_11)","decl":{"start":{"line":114,"column":40},"end":{"line":114,"column":41}},"loc":{"start":{"line":114,"column":52},"end":{"line":116,"column":1}},"line":114},"12":{"name":"(anonymous_12)","decl":{"start":{"line":117,"column":30},"end":{"line":117,"column":31}},"loc":{"start":{"line":117,"column":48},"end":{"line":120,"column":1}},"line":117}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},{"start":{},"end":{}}],"line":72},"4":{"loc":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},{"start":{},"end":{}}],"line":76},"5":{"loc":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},{"start":{},"end":{}}],"line":79},"6":{"loc":{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},"type":"if","locations":[{"start":{"line":90,"column":4},"end":{"line":92,"column":5}},{"start":{},"end":{}}],"line":90},"7":{"loc":{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},{"start":{},"end":{}}],"line":101},"8":{"loc":{"start":{"line":104,"column":4},"end":{"line":109,"column":5}},"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":109,"column":5}},{"start":{"line":107,"column":9},"end":{"line":109,"column":5}}],"line":104}},"s":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":10,"16":10,"17":10,"18":10,"19":10,"20":10,"21":1,"22":0,"23":1,"24":2,"25":0,"26":2,"27":2,"28":0,"29":2,"30":0,"31":2,"32":2,"33":2,"34":2,"35":2,"36":1,"37":1,"38":1,"39":0,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":0,"49":1,"50":1,"51":0,"52":1,"53":1,"54":1,"55":1,"56":0,"57":1,"58":1,"59":1,"60":1,"61":1},"f":{"0":2,"1":10,"2":10,"3":10,"4":10,"5":10,"6":10,"7":0,"8":2,"9":1,"10":1,"11":0,"12":1},"b":{"0":[1,1,1],"1":[2,0],"2":[2,2],"3":[0,2],"4":[0,2],"5":[0,2],"6":[0,1],"7":[0,1],"8":[1,0]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/user.ts","sources":["/usr/src/app/src/models/user/user.ts"],"names":[],"mappings":"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","sourcesContent":["import { User as DiscordUser } from 'discord.js';\nimport { HydratedDocument, model, Model, Schema } from 'mongoose';\nimport { ExperienceModule, ExperienceSchema } from './experience';\nimport { AttributesModule, AttributesSchema } from './attributes';\nimport { SkinModule, SkinSchema } from './skin';\nimport PartManager from '../../libs/montage/PartManager';\nimport { Missions, MissionsSchema } from './missions';\nimport { InventoryModule, InventorySchema } from './inventory';\nimport { StuffModule, StuffSchema } from './stuff';\nimport { ShopModule, ShopSchema } from '../item/shop';\nimport { ItemModel } from '../item/item';\nimport StuffMontage from '../../libs/montage/StuffMontage';\nimport { userInfo } from 'os';\n\n// Données du document\ninterface IUser {\n    id: string;\n    gold: number;\n    experience: ExperienceModule;\n    attributes: AttributesModule;\n    skin: SkinModule;\n    mission: Missions;\n    shop: ShopModule;\n    inventory: InventoryModule;\n    stuff: StuffModule;\n}\n\n// Méthodes sur l'instance\ninterface IUserMethods {\n    buyItem(n: number): Promise<boolean>;\n    sellItem(n: number): Promise<string>;\n    equipItem(n: number): Promise<void>;\n    getTotalAttributes(): AttributesModule;\n    getImage(): Promise<string>;\n}\n\n// Méthodes statiques\ninterface IUserModel extends Model<IUser, object, IUserMethods> {\n    findByDiscordUser(user: DiscordUser): Promise<User | null>;\n}\n\nexport type User = HydratedDocument<IUser, IUserMethods>;\n\nconst UserSchema: Schema = new Schema<IUser, object, IUserMethods>(\n    {\n        id: {\n            type: String,\n            required: true,\n            unique: true,\n        },\n        gold: {\n            type: Number,\n            required: true,\n            default: 0,\n        },\n        experience: {\n            type: ExperienceSchema,\n            required: true,\n            default: () => ({}),\n        },\n        attributes: {\n            type: AttributesSchema,\n            required: true,\n            default: () => ({}), // On doit mettre ça pour que ça prenne les valeurs par défaut du schéma enfant\n        },\n        skin: {\n            type: SkinSchema,\n            required: true,\n            default: PartManager.getRandomSkin(),\n        },\n        mission: {\n            type: MissionsSchema,\n            required: true,\n            default: () => ({}),\n        },\n        shop: {\n            type: ShopSchema,\n            required: true,\n            default: () => ({}),\n        },\n        inventory: {\n            type: InventorySchema,\n            required: true,\n            default: () => ({}),\n        },\n        stuff: {\n            type: StuffSchema,\n            required: true,\n            default: () => ({}),\n        },\n    },\n    {\n        timestamps: true,\n    },\n);\n\nUserSchema.statics.findByDiscordUser = async (user: DiscordUser): Promise<User | null> => {\n    return await UserModel.findOne({\n        id: user.id,\n    });\n};\n\n/**\n * Achète l'item numéro N de la boutique et la place dans l'inventaire\n * @param n\n * @returns\n */\nUserSchema.methods.buyItem = async function (n: number): Promise<boolean> {\n    if (this.inventory.items.length >= 5) {\n        throw new Error('Votre inventaire est déja plein, vous pouvez vendre un item via `/inventory`');\n    }\n\n    const item: ItemModel = this.shop.items[n];\n\n    if (!item) {\n        throw new Error(\"Impossible de trouver l'équipement dans la boutique\");\n    }\n\n    if (item.price > this.gold) {\n        throw new Error(\"Vous n'avez pas assez de pièce pour acheter cette équipement\");\n    }\n\n    this.inventory.items.push(item);\n\n    this.shop.items.splice(n, 1);\n\n    this.gold -= item.price;\n\n    await this.save();\n\n    return item.level <= this.experience.level;\n};\n\n/**\n * Vend l'item numéro N de l'inventaire\n * @param n\n * @returns\n */\nUserSchema.methods.sellItem = async function (n: number): Promise<string> {\n    const item: ItemModel = this.inventory.items[n];\n\n    if (!item) {\n        return \"Impossible de trouver l'équipement dans votre inventaire\";\n    }\n\n    this.inventory.items.splice(n, 1);\n\n    this.gold += item.getSellPrice();\n\n    await this.save();\n\n    return 'Vente réussie';\n};\n\n/**\n * Equipe l'item numéro N de l'inventaire, si un équipement est déja équipé il va dans l'inventaire\n * @param n\n */\nUserSchema.methods.equipItem = async function (n: number): Promise<void> {\n    const inventoryItem = this.inventory.items[n];\n    const stuffItem = this.stuff.getItemByType(inventoryItem.type);\n\n    if (inventoryItem.level > this.experience.level) {\n        return;\n    }\n\n    if (stuffItem === null) {\n        this.inventory.items.splice(n, 1);\n    } else {\n        this.inventory.items[n] = stuffItem;\n    }\n\n    this.stuff.equipItem(inventoryItem);\n\n    StuffMontage.generateImage(this as User);\n\n    await this.save();\n};\n\n/**\n * Compte toutes les caractéristiques en prenant en compte le stuff et les points de carac du joueur\n * @returns\n */\nUserSchema.methods.getTotalAttributes = function (): AttributesModule {\n    return this.attributes.add(this.stuff.getTotalAttributes());\n};\n\nUserSchema.methods.getImage = async function (): Promise<string> {\n    const skin = await StuffMontage.getImage(this as User);\n\n    return skin;\n};\n\nconst UserModel = model<IUser, IUserModel>('User', UserSchema);\n\nexport { UserModel };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cd625b8a3722ea60285ad80b45b19d8bae79c6eb"},"/usr/src/app/src/models/user/experience.ts":{"path":"/usr/src/app/src/models/user/experience.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":22,"column":0},"end":{"line":28,"column":2}},"5":{"start":{"line":23,"column":4},"end":{"line":23,"column":37}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":57}},"7":{"start":{"line":25,"column":27},"end":{"line":25,"column":56}},"8":{"start":{"line":26,"column":28},"end":{"line":26,"column":69}},"9":{"start":{"line":27,"column":4},"end":{"line":27,"column":98}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":22,"column":39},"end":{"line":22,"column":40}},"loc":{"start":{"line":22,"column":57},"end":{"line":28,"column":1}},"line":22}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1},"f":{"0":1},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/experience.ts","sources":["/usr/src/app/src/models/user/experience.ts"],"names":[],"mappings":";;;AAAA,uCAAoD;AAgBvC,QAAA,gBAAgB,GAAW,IAAI,iBAAM,CAA0C;IACxF,KAAK,EAAE;QACH,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,CAAC;KACb;IACD,KAAK,EAAE;QACH,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,CAAC;KACb;IACD,WAAW,EAAE;QACT,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,CAAC;KACb;CACJ,CAAC,CAAC;AAMH,wBAAgB,CAAC,OAAO,CAAC,GAAG,GAAG,UAAU,MAAc;IACnD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;IAEjC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC;IAErD,MAAM,cAAc,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;IACrD,MAAM,eAAe,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;IAElE,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,cAAc,CAAC,GAAG,CAAC,eAAe,GAAG,cAAc,CAAC,CAAC,GAAG,GAAG,CAAC;AAClG,CAAC,CAAC","sourcesContent":["import { HydratedDocument, Schema } from 'mongoose';\n\n// Données du document\ninterface IExperience {\n    total: number;\n    level: number;\n    progression: number;\n}\n\n// Méthodes sur l'instance\ninterface IExperienceMethods {\n    add(amount: number): void;\n}\n\nexport type ExperienceModule = HydratedDocument<IExperience, IExperienceMethods>;\n\nexport const ExperienceSchema: Schema = new Schema<IExperience, object, IExperienceMethods>({\n    total: {\n        type: Number,\n        required: true,\n        default: 0,\n    },\n    level: {\n        type: Number,\n        required: true,\n        default: 1,\n    },\n    progression: {\n        type: Number,\n        required: true,\n        default: 1,\n    },\n});\n\n/**\n * Ajoute de l'expérience au joueur et recalcule l'avancement et le niveau\n * @param amount\n */\nExperienceSchema.methods.add = function (amount: number) {\n    this.total = this.total + amount;\n\n    this.level = Math.floor(Math.sqrt(this.total / 100));\n\n    const xpNiveauActuel = 100 * this.level * this.level;\n    const xpNiveauSuivant = 100 * (this.level + 1) * (this.level + 1);\n\n    this.progression = ((this.total - xpNiveauActuel) / (xpNiveauSuivant - xpNiveauActuel)) * 100;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9343b51f1b2d6d4285621ed86bdd9751fec40b47"},"/usr/src/app/src/models/user/attributes.ts":{"path":"/usr/src/app/src/models/user/attributes.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":60}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":26,"column":3}},"4":{"start":{"line":27,"column":0},"end":{"line":32,"column":2}},"5":{"start":{"line":28,"column":16},"end":{"line":28,"column":17}},"6":{"start":{"line":29,"column":17},"end":{"line":29,"column":79}},"7":{"start":{"line":29,"column":60},"end":{"line":29,"column":78}},"8":{"start":{"line":30,"column":4},"end":{"line":30,"column":44}},"9":{"start":{"line":30,"column":25},"end":{"line":30,"column":41}},"10":{"start":{"line":31,"column":4},"end":{"line":31,"column":17}},"11":{"start":{"line":33,"column":0},"end":{"line":41,"column":2}},"12":{"start":{"line":34,"column":26},"end":{"line":34,"column":37}},"13":{"start":{"line":35,"column":17},"end":{"line":35,"column":79}},"14":{"start":{"line":35,"column":60},"end":{"line":35,"column":78}},"15":{"start":{"line":36,"column":4},"end":{"line":40,"column":5}},"16":{"start":{"line":37,"column":27},"end":{"line":37,"column":72}},"17":{"start":{"line":38,"column":8},"end":{"line":38,"column":30}},"18":{"start":{"line":39,"column":8},"end":{"line":39,"column":29}},"19":{"start":{"line":42,"column":0},"end":{"line":45,"column":2}},"20":{"start":{"line":43,"column":17},"end":{"line":43,"column":79}},"21":{"start":{"line":43,"column":60},"end":{"line":43,"column":78}},"22":{"start":{"line":44,"column":4},"end":{"line":44,"column":77}},"23":{"start":{"line":44,"column":25},"end":{"line":44,"column":74}},"24":{"start":{"line":46,"column":0},"end":{"line":54,"column":2}},"25":{"start":{"line":47,"column":19},"end":{"line":47,"column":40}},"26":{"start":{"line":48,"column":17},"end":{"line":48,"column":79}},"27":{"start":{"line":48,"column":60},"end":{"line":48,"column":78}},"28":{"start":{"line":49,"column":4},"end":{"line":52,"column":7}},"29":{"start":{"line":50,"column":18},"end":{"line":50,"column":19}},"30":{"start":{"line":51,"column":8},"end":{"line":51,"column":44}},"31":{"start":{"line":53,"column":4},"end":{"line":53,"column":18}},"32":{"start":{"line":55,"column":24},"end":{"line":55,"column":85}},"33":{"start":{"line":56,"column":0},"end":{"line":56,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":27,"column":50},"end":{"line":27,"column":51}},"loc":{"start":{"line":27,"column":62},"end":{"line":32,"column":1}},"line":27},"1":{"name":"(anonymous_1)","decl":{"start":{"line":29,"column":53},"end":{"line":29,"column":54}},"loc":{"start":{"line":29,"column":60},"end":{"line":29,"column":78}},"line":29},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":17},"end":{"line":30,"column":18}},"loc":{"start":{"line":30,"column":25},"end":{"line":30,"column":41}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":52},"end":{"line":33,"column":53}},"loc":{"start":{"line":33,"column":75},"end":{"line":41,"column":1}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":35,"column":53},"end":{"line":35,"column":54}},"loc":{"start":{"line":35,"column":60},"end":{"line":35,"column":78}},"line":35},"5":{"name":"(anonymous_5)","decl":{"start":{"line":42,"column":47},"end":{"line":42,"column":48}},"loc":{"start":{"line":42,"column":65},"end":{"line":45,"column":1}},"line":42},"6":{"name":"(anonymous_6)","decl":{"start":{"line":43,"column":53},"end":{"line":43,"column":54}},"loc":{"start":{"line":43,"column":60},"end":{"line":43,"column":78}},"line":43},"7":{"name":"(anonymous_7)","decl":{"start":{"line":44,"column":17},"end":{"line":44,"column":18}},"loc":{"start":{"line":44,"column":25},"end":{"line":44,"column":74}},"line":44},"8":{"name":"(anonymous_8)","decl":{"start":{"line":46,"column":39},"end":{"line":46,"column":40}},"loc":{"start":{"line":46,"column":55},"end":{"line":54,"column":1}},"line":46},"9":{"name":"(anonymous_9)","decl":{"start":{"line":48,"column":53},"end":{"line":48,"column":54}},"loc":{"start":{"line":48,"column":60},"end":{"line":48,"column":78}},"line":48},"10":{"name":"(anonymous_10)","decl":{"start":{"line":49,"column":13},"end":{"line":49,"column":14}},"loc":{"start":{"line":49,"column":20},"end":{"line":52,"column":5}},"line":49}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":2,"7":10,"8":2,"9":8,"10":2,"11":1,"12":62,"13":62,"14":310,"15":62,"16":3508,"17":3508,"18":3508,"19":1,"20":11,"21":55,"22":11,"23":44,"24":1,"25":1,"26":1,"27":5,"28":1,"29":4,"30":4,"31":1,"32":1,"33":1},"f":{"0":2,"1":10,"2":8,"3":62,"4":310,"5":11,"6":55,"7":44,"8":1,"9":5,"10":4},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/attributes.ts","sources":["/usr/src/app/src/models/user/attributes.ts"],"names":[],"mappings":"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","sourcesContent":["import { HydratedDocument, Model, model, Schema } from 'mongoose';\nimport Rarity from '../../enum/rarity';\nimport { EmbedBuilder } from 'discord.js';\nimport { ItemModel } from '../item/item';\n\nexport interface IAttributes {\n    strength: number;\n    health: number;\n    dexterity: number;\n    dodge: number;\n}\n\n// Méthodes sur l'instance\ninterface IAttributesMethods {\n    getTotalPoints(): number;\n    distributePoints(totalPoints: number): void;\n    applyRarity(rarity: Rarity): void;\n    addToEmbed(embed: EmbedBuilder, stuffedItem?: ItemModel | null): EmbedBuilder;\n    add(attr: AttributesModule): AttributesModule;\n    toString(): string;\n}\n\ninterface IAttributesModel extends Model<IAttributes, object, IAttributesMethods> {\n    static(): void;\n}\n\nexport type AttributesModule = HydratedDocument<IAttributes, IAttributesMethods>;\n\nexport const AttributesSchema: Schema = new Schema<IAttributes, object, IAttributesMethods>({\n    strength: {\n        type: Number,\n        required: true,\n        default: 0,\n    },\n    health: {\n        type: Number,\n        required: true,\n        default: 0,\n    },\n    dexterity: {\n        type: Number,\n        required: true,\n        default: 0,\n    },\n    dodge: {\n        type: Number,\n        required: true,\n        default: 0,\n    },\n});\n\n/**\n * Retourne le nombre de points total\n */\nAttributesSchema.methods.getTotalPoints = function (): number {\n    let total = 0;\n\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n\n    keys.forEach((k) => (total += this[k]));\n\n    return total;\n};\n\n/**\n * Distribue un total de points aléatoirement\n * @param totalPoints\n */\nAttributesSchema.methods.distributePoints = function (totalPoints: number): void {\n    let remainingPoints = totalPoints;\n\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n\n    while (remainingPoints > 0) {\n        const randomAttr = keys[Math.floor(Math.random() * keys.length)];\n        this[randomAttr] += 1;\n        remainingPoints -= 1;\n    }\n};\n\n/**\n * Applique le multiplier d'une rareté sur tous les attributs\n * @param rarity\n */\nAttributesSchema.methods.applyRarity = function (rarity: Rarity): void {\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n\n    keys.forEach((k) => (this[k] = Math.round(this[k] * rarity.multiplier)));\n};\n\n/**\n * Additionne deux objets attributs ensemble\n * @param attr\n * @returns\n */\nAttributesSchema.methods.add = function (attr: AttributesModule): AttributesModule {\n    const result = new AttributesModel();\n\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n\n    keys.map((k) => {\n        let key = k as keyof IAttributes;\n        result[key] = attr[key] + this[key];\n    });\n\n    return result;\n};\n\nconst AttributesModel = model<IAttributes, IAttributesModel>('Attributes', AttributesSchema);\n\nexport { AttributesModel };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"58976e60be68407f91e8d2d1ceb4dd86f17114a5"},"/usr/src/app/src/models/user/skin.ts":{"path":"/usr/src/app/src/models/user/skin.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":65}},"4":{"start":{"line":7,"column":19},"end":{"line":7,"column":38}},"5":{"start":{"line":8,"column":22},"end":{"line":8,"column":80}},"6":{"start":{"line":10,"column":0},"end":{"line":13,"column":45}},"7":{"start":{"line":11,"column":4},"end":{"line":11,"column":30}},"8":{"start":{"line":12,"column":4},"end":{"line":12,"column":28}},"9":{"start":{"line":14,"column":23},"end":{"line":17,"column":1}},"10":{"start":{"line":18,"column":0},"end":{"line":33,"column":3}},"11":{"start":{"line":34,"column":0},"end":{"line":36,"column":2}},"12":{"start":{"line":35,"column":4},"end":{"line":35,"column":54}},"13":{"start":{"line":37,"column":0},"end":{"line":44,"column":2}},"14":{"start":{"line":38,"column":4},"end":{"line":43,"column":5}},"15":{"start":{"line":39,"column":8},"end":{"line":39,"column":33}},"16":{"start":{"line":42,"column":8},"end":{"line":42,"column":35}},"17":{"start":{"line":45,"column":0},"end":{"line":50,"column":2}},"18":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":15}},"20":{"start":{"line":49,"column":4},"end":{"line":49,"column":104}},"21":{"start":{"line":51,"column":0},"end":{"line":56,"column":2}},"22":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"23":{"start":{"line":53,"column":8},"end":{"line":53,"column":15}},"24":{"start":{"line":55,"column":4},"end":{"line":55,"column":104}},"25":{"start":{"line":57,"column":18},"end":{"line":57,"column":67}},"26":{"start":{"line":58,"column":0},"end":{"line":58,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":1},"end":{"line":10,"column":2}},"loc":{"start":{"line":10,"column":19},"end":{"line":13,"column":1}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":34,"column":38},"end":{"line":34,"column":39}},"loc":{"start":{"line":34,"column":56},"end":{"line":36,"column":1}},"line":34},"3":{"name":"(anonymous_3)","decl":{"start":{"line":37,"column":42},"end":{"line":37,"column":43}},"loc":{"start":{"line":37,"column":54},"end":{"line":44,"column":1}},"line":37},"4":{"name":"(anonymous_4)","decl":{"start":{"line":45,"column":47},"end":{"line":45,"column":48}},"loc":{"start":{"line":45,"column":68},"end":{"line":50,"column":1}},"line":45},"5":{"name":"(anonymous_5)","decl":{"start":{"line":51,"column":47},"end":{"line":51,"column":48}},"loc":{"start":{"line":51,"column":68},"end":{"line":56,"column":1}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":13,"column":3},"end":{"line":13,"column":43}},"type":"binary-expr","locations":[{"start":{"line":13,"column":3},"end":{"line":13,"column":9}},{"start":{"line":13,"column":14},"end":{"line":13,"column":42}}],"line":13},"4":{"loc":{"start":{"line":38,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":43,"column":5}},{"start":{"line":41,"column":9},"end":{"line":43,"column":5}}],"line":38},"5":{"loc":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},{"start":{},"end":{}}],"line":46},"6":{"loc":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},{"start":{},"end":{}}],"line":52}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":2,"13":1,"14":1,"15":0,"16":1,"17":1,"18":2,"19":0,"20":2,"21":1,"22":2,"23":0,"24":2,"25":1,"26":1},"f":{"0":1,"1":1,"2":2,"3":1,"4":2,"5":2},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[1,1],"4":[0,1],"5":[0,2],"6":[0,2]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/skin.ts","sources":["/usr/src/app/src/models/user/skin.ts"],"names":[],"mappings":";;;;;;AAAA,uCAAkE;AAClE,iFAAyD;AAEzD,IAAY,MAGX;AAHD,WAAY,MAAM;IACd,yBAAe,CAAA;IACf,uBAAa,CAAA;AACjB,CAAC,EAHW,MAAM,sBAAN,MAAM,QAGjB;AAgBD,MAAM,cAAc,GAAG;IACnB,IAAI,EAAE,MAAM;IACZ,QAAQ,EAAE,IAAI;CACjB,CAAC;AAiBW,QAAA,UAAU,GAAW,IAAI,iBAAM,CAA8B;IACtE,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,KAAK,EAAE,cAAc;IACrB,IAAI,EAAE,cAAc;IACpB,QAAQ,EAAE,cAAc;IACxB,IAAI,EAAE,cAAc;IACpB,IAAI,EAAE,cAAc;IACpB,KAAK,EAAE,cAAc;IACrB,IAAI,EAAE,cAAc;IACpB,UAAU,EAAE,cAAc;IAC1B,WAAW,EAAE,cAAc;CAC9B,CAAC,CAAC;AAEH,kBAAU,CAAC,OAAO,CAAC,QAAQ,GAAG,KAAK;IAC/B,OAAO,MAAM,qBAAW,CAAC,QAAQ,CAAC,IAAkB,CAAC,CAAC;AAC1D,CAAC,CAAC;AAEF,kBAAU,CAAC,OAAO,CAAC,YAAY,GAAG;IAC9B,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC;IAC7B,CAAC;SAAM,CAAC;QACJ,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC;IAC/B,CAAC;AACL,CAAC,CAAC;AAEF,kBAAU,CAAC,OAAO,CAAC,iBAAiB,GAAG,UAAU,SAAsB;IACnE,IAAI,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,QAAQ,EAAE,CAAC;QACtC,OAAO;IACX,CAAC;IAED,IAAI,CAAC,SAAS,CAAC,GAAG,qBAAW,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAC9F,CAAC,CAAC;AAEF,kBAAU,CAAC,OAAO,CAAC,iBAAiB,GAAG,UAAU,SAAsB;IACnE,IAAI,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,QAAQ,EAAE,CAAC;QACtC,OAAO;IACX,CAAC;IAED,IAAI,CAAC,SAAS,CAAC,GAAG,qBAAW,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAC9F,CAAC,CAAC;AAEF,MAAM,SAAS,GAAG,IAAA,gBAAK,EAAoB,MAAM,EAAE,kBAAU,CAAC,CAAC;AAEtD,8BAAS","sourcesContent":["import { HydratedDocument, model, Model, Schema } from 'mongoose';\nimport PartManager from '../../libs/montage/PartManager';\n\nexport enum Gender {\n    Women = 'Femme',\n    Men = 'Homme',\n}\n\n// Données du document\nexport interface ISkin {\n    gender: Gender;\n    color: number;\n    eyes: number;\n    eyebrows: number;\n    hair: number;\n    head: number;\n    mouth: number;\n    nose: number;\n    decoration: number;\n    facial_hair: number;\n}\n\nconst schemaProperty = {\n    type: Number,\n    required: true,\n};\n\n// Méthodes sur l'instance\ninterface ISkinMethods {\n    getImage(): Promise<string>;\n    switchGender(): void;\n    increaseAttribute(attribute: keyof ISkin): void;\n    decreaseAttribute(attribute: keyof ISkin): void;\n}\n\n// Méthodes statiques\ninterface ISkinModel extends Model<ISkin, object, ISkinMethods> {\n    static: () => void;\n}\n\nexport type SkinModule = HydratedDocument<ISkin, ISkinMethods>;\n\nexport const SkinSchema: Schema = new Schema<ISkin, object, ISkinMethods>({\n    gender: {\n        type: String,\n        enum: Gender,\n        required: true,\n    },\n    color: schemaProperty,\n    eyes: schemaProperty,\n    eyebrows: schemaProperty,\n    hair: schemaProperty,\n    head: schemaProperty,\n    mouth: schemaProperty,\n    nose: schemaProperty,\n    decoration: schemaProperty,\n    facial_hair: schemaProperty,\n});\n\nSkinSchema.methods.getImage = async function (): Promise<string> {\n    return await PartManager.getImage(this as SkinModule);\n};\n\nSkinSchema.methods.switchGender = function () {\n    if (this.gender === Gender.Women) {\n        this.gender = Gender.Men;\n    } else {\n        this.gender = Gender.Women;\n    }\n};\n\nSkinSchema.methods.increaseAttribute = function (attribute: keyof ISkin): void {\n    if (typeof this[attribute] !== 'number') {\n        return;\n    }\n\n    this[attribute] = PartManager.getPart(attribute)?.clamp(this[attribute] + 1, this.gender);\n};\n\nSkinSchema.methods.decreaseAttribute = function (attribute: keyof ISkin): void {\n    if (typeof this[attribute] !== 'number') {\n        return;\n    }\n\n    this[attribute] = PartManager.getPart(attribute)?.clamp(this[attribute] - 1, this.gender);\n};\n\nconst SkinModel = model<ISkin, ISkinModel>('Skin', SkinSchema);\n\nexport { SkinModel };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c8ed3bfd52e2fe86ee5e58464e11eeaed7e3fc7b"},"/usr/src/app/src/libs/montage/PartManager.ts":{"path":"/usr/src/app/src/libs/montage/PartManager.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"25":{"start":{"line":26,"column":4},"end":{"line":26,"column":62}},"26":{"start":{"line":28,"column":0},"end":{"line":28,"column":62}},"27":{"start":{"line":29,"column":17},"end":{"line":29,"column":34}},"28":{"start":{"line":30,"column":15},"end":{"line":30,"column":48}},"29":{"start":{"line":31,"column":16},"end":{"line":31,"column":35}},"30":{"start":{"line":32,"column":15},"end":{"line":32,"column":49}},"31":{"start":{"line":33,"column":24},"end":{"line":33,"column":67}},"32":{"start":{"line":34,"column":13},"end":{"line":34,"column":42}},"33":{"start":{"line":35,"column":11},"end":{"line":35,"column":38}},"34":{"start":{"line":36,"column":21},"end":{"line":36,"column":42}},"35":{"start":{"line":37,"column":23},"end":{"line":37,"column":65}},"36":{"start":{"line":40,"column":29},"end":{"line":40,"column":72}},"37":{"start":{"line":41,"column":27},"end":{"line":43,"column":9}},"38":{"start":{"line":44,"column":8},"end":{"line":46,"column":11}},"39":{"start":{"line":45,"column":12},"end":{"line":45,"column":75}},"40":{"start":{"line":47,"column":8},"end":{"line":47,"column":53}},"41":{"start":{"line":48,"column":21},"end":{"line":48,"column":53}},"42":{"start":{"line":49,"column":8},"end":{"line":49,"column":20}},"43":{"start":{"line":52,"column":26},"end":{"line":52,"column":53}},"44":{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},"45":{"start":{"line":54,"column":12},"end":{"line":54,"column":29}},"46":{"start":{"line":56,"column":8},"end":{"line":56,"column":39}},"47":{"start":{"line":57,"column":8},"end":{"line":57,"column":25}},"48":{"start":{"line":60,"column":21},"end":{"line":60,"column":23}},"49":{"start":{"line":61,"column":30},"end":{"line":69,"column":38}},"50":{"start":{"line":63,"column":12},"end":{"line":66,"column":13}},"51":{"start":{"line":65,"column":16},"end":{"line":65,"column":28}},"52":{"start":{"line":67,"column":12},"end":{"line":67,"column":21}},"53":{"start":{"line":69,"column":27},"end":{"line":69,"column":37}},"54":{"start":{"line":70,"column":8},"end":{"line":75,"column":9}},"55":{"start":{"line":70,"column":21},"end":{"line":70,"column":22}},"56":{"start":{"line":71,"column":26},"end":{"line":71,"column":55}},"57":{"start":{"line":72,"column":24},"end":{"line":72,"column":59}},"58":{"start":{"line":73,"column":12},"end":{"line":73,"column":68}},"59":{"start":{"line":73,"column":33},"end":{"line":73,"column":66}},"60":{"start":{"line":74,"column":12},"end":{"line":74,"column":27}},"61":{"start":{"line":76,"column":8},"end":{"line":82,"column":64}},"62":{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},"63":{"start":{"line":84,"column":12},"end":{"line":84,"column":59}},"64":{"start":{"line":86,"column":8},"end":{"line":90,"column":205}},"65":{"start":{"line":91,"column":8},"end":{"line":91,"column":20}},"66":{"start":{"line":94,"column":8},"end":{"line":94,"column":70}},"67":{"start":{"line":94,"column":38},"end":{"line":94,"column":68}},"68":{"start":{"line":97,"column":23},"end":{"line":97,"column":59}},"69":{"start":{"line":98,"column":20},"end":{"line":98,"column":43}},"70":{"start":{"line":99,"column":8},"end":{"line":101,"column":9}},"71":{"start":{"line":100,"column":12},"end":{"line":100,"column":44}},"72":{"start":{"line":102,"column":23},"end":{"line":102,"column":51}},"73":{"start":{"line":103,"column":8},"end":{"line":103,"column":62}},"74":{"start":{"line":106,"column":27},"end":{"line":106,"column":70}},"75":{"start":{"line":107,"column":8},"end":{"line":107,"column":71}},"76":{"start":{"line":110,"column":0},"end":{"line":121,"column":2}},"77":{"start":{"line":122,"column":0},"end":{"line":122,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":56},"end":{"line":25,"column":57}},"loc":{"start":{"line":25,"column":71},"end":{"line":27,"column":1}},"line":25},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":27},"end":{"line":50,"column":5}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":44,"column":27},"end":{"line":44,"column":28}},"loc":{"start":{"line":44,"column":37},"end":{"line":46,"column":9}},"line":44},"9":{"name":"(anonymous_9)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":32},"end":{"line":58,"column":5}},"line":51},"10":{"name":"(anonymous_10)","decl":{"start":{"line":59,"column":4},"end":{"line":59,"column":5}},"loc":{"start":{"line":59,"column":25},"end":{"line":92,"column":5}},"line":59},"11":{"name":"(anonymous_11)","decl":{"start":{"line":62,"column":17},"end":{"line":62,"column":18}},"loc":{"start":{"line":62,"column":24},"end":{"line":68,"column":9}},"line":62},"12":{"name":"(anonymous_12)","decl":{"start":{"line":69,"column":20},"end":{"line":69,"column":21}},"loc":{"start":{"line":69,"column":27},"end":{"line":69,"column":37}},"line":69},"13":{"name":"(anonymous_13)","decl":{"start":{"line":73,"column":26},"end":{"line":73,"column":27}},"loc":{"start":{"line":73,"column":33},"end":{"line":73,"column":66}},"line":73},"14":{"name":"(anonymous_14)","decl":{"start":{"line":93,"column":4},"end":{"line":93,"column":5}},"loc":{"start":{"line":93,"column":30},"end":{"line":95,"column":5}},"line":93},"15":{"name":"(anonymous_15)","decl":{"start":{"line":94,"column":31},"end":{"line":94,"column":32}},"loc":{"start":{"line":94,"column":38},"end":{"line":94,"column":68}},"line":94},"16":{"name":"(anonymous_16)","decl":{"start":{"line":96,"column":4},"end":{"line":96,"column":5}},"loc":{"start":{"line":96,"column":37},"end":{"line":104,"column":5}},"line":96},"17":{"name":"(anonymous_17)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":34},"end":{"line":108,"column":5}},"line":105}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":27}},{"start":{"line":25,"column":31},"end":{"line":25,"column":51}},{"start":{"line":25,"column":56},"end":{"line":27,"column":1}}],"line":25},"17":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":61}},"type":"cond-expr","locations":[{"start":{"line":26,"column":37},"end":{"line":26,"column":40}},{"start":{"line":26,"column":43},"end":{"line":26,"column":61}}],"line":26},"18":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":33}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":15}},{"start":{"line":26,"column":19},"end":{"line":26,"column":33}}],"line":26},"19":{"loc":{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},"type":"if","locations":[{"start":{"line":53,"column":8},"end":{"line":55,"column":9}},{"start":{},"end":{}}],"line":53},"20":{"loc":{"start":{"line":63,"column":12},"end":{"line":66,"column":13}},"type":"if","locations":[{"start":{"line":63,"column":12},"end":{"line":66,"column":13}},{"start":{},"end":{}}],"line":63},"21":{"loc":{"start":{"line":63,"column":16},"end":{"line":64,"column":59}},"type":"binary-expr","locations":[{"start":{"line":63,"column":17},"end":{"line":63,"column":52}},{"start":{"line":63,"column":56},"end":{"line":63,"column":90}},{"start":{"line":64,"column":16},"end":{"line":64,"column":59}}],"line":63},"22":{"loc":{"start":{"line":82,"column":33},"end":{"line":82,"column":61}},"type":"binary-expr","locations":[{"start":{"line":82,"column":33},"end":{"line":82,"column":55}},{"start":{"line":82,"column":59},"end":{"line":82,"column":61}}],"line":82},"23":{"loc":{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},"type":"if","locations":[{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},{"start":{},"end":{}}],"line":83},"24":{"loc":{"start":{"line":87,"column":22},"end":{"line":87,"column":75}},"type":"cond-expr","locations":[{"start":{"line":87,"column":58},"end":{"line":87,"column":65}},{"start":{"line":87,"column":68},"end":{"line":87,"column":75}}],"line":87},"25":{"loc":{"start":{"line":90,"column":22},"end":{"line":90,"column":69}},"type":"cond-expr","locations":[{"start":{"line":90,"column":58},"end":{"line":90,"column":62}},{"start":{"line":90,"column":65},"end":{"line":90,"column":69}}],"line":90}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":6,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":3,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":10,"40":1,"41":1,"42":1,"43":2,"44":2,"45":1,"46":1,"47":1,"48":1,"49":1,"50":10,"51":2,"52":8,"53":10,"54":1,"55":1,"56":4,"57":4,"58":4,"59":8,"60":4,"61":1,"62":1,"63":1,"64":1,"65":1,"66":4,"67":26,"68":1,"69":1,"70":1,"71":10,"72":1,"73":1,"74":3,"75":3,"76":1,"77":1},"f":{"0":119,"1":6,"2":0,"3":2,"4":0,"5":2,"6":3,"7":1,"8":10,"9":2,"10":1,"11":10,"12":10,"13":8,"14":4,"15":26,"16":1,"17":3},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[1,1,1],"17":[3,0],"18":[3,3],"19":[1,1],"20":[2,8],"21":[10,10,9],"22":[1,0],"23":[1,0],"24":[0,1],"25":[0,1]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/montage/PartManager.ts","sources":["/usr/src/app/src/libs/montage/PartManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { createCanvas } from 'canvas';\nimport { Gender, ISkin, SkinModel, SkinModule } from '../../models/user/skin';\nimport { randomEnumValue } from '../utils';\nimport Part from './Part';\nimport PartWithColor from './PartWithColor';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ActionRowBuilder, ButtonBuilder, ButtonStyle } from 'discord.js';\nimport PartHairBack from './PartHairBack';\n\nexport default class PartManager {\n    private static parts: Part[] = [\n        new PartHairBack(),\n        new Part('color', 'Couleur'),\n        new PartWithColor('head', 'Visage'),\n        new PartWithColor('nose', 'Nez'),\n        new PartWithColor('mouth', 'Bouche'),\n        new Part('eyes', 'Yeux'),\n        new Part('eyebrows', 'Sourcils'),\n        new Part('hair', 'Cheveux'),\n        new Part('facial_hair', 'Barbe', false),\n        new Part('decoration', 'Extra', false),\n    ];\n\n    /**\n     * Génère un skin aléatoire avec des valeurs possibles\n     * @returns Skin\n     */\n    public static getRandomSkin(): SkinModule {\n        const randomGender = randomEnumValue(Gender);\n\n        const attributes: { [k: string]: number | string } = {\n            gender: randomGender,\n        };\n\n        this.parts.forEach((part) => {\n            attributes[part.getAttribute()] = part.getRandom(randomGender as Gender);\n        });\n\n        attributes['hair_back'] = attributes['hair'];\n\n        const skin = new SkinModel(attributes);\n\n        return skin;\n    }\n\n    /**\n     * Retourne l'image du skin\n     */\n    public static async getImage(skin: SkinModule): Promise<string> {\n        const imagePath = this.getSkinImagePath(skin);\n\n        if (fs.existsSync(imagePath)) {\n            return imagePath;\n        }\n\n        await this.generateImage(skin);\n\n        return imagePath;\n    }\n\n    /**\n     * Retourne les sélecteurs pour chaque attribut\n     */\n    public static getRows(skin: SkinModule): ActionRowBuilder<ButtonBuilder>[] {\n        const rows: ActionRowBuilder<ButtonBuilder>[] = [];\n\n        // On enlève la barbe pour les femmes\n        const filteredParts = this.parts\n            .map((p) => {\n                if (\n                    (skin.gender === Gender.Women && p.getAttribute() === 'facial_hair') ||\n                    p.getAttribute().toString() === 'hair_back'\n                ) {\n                    return null;\n                }\n\n                return p;\n            })\n            .filter((p) => p !== null);\n\n        for (let i = 0; i < filteredParts.length; i += 2) {\n            const chunk = filteredParts.slice(i, i + 2);\n            const row = new ActionRowBuilder<ButtonBuilder>();\n\n            chunk.forEach((c) => row.addComponents(c.getButtons()));\n\n            rows.push(row);\n        }\n\n        rows\n            .at(0)\n            ?.setComponents(\n                new ButtonBuilder()\n                    .setLabel('Aléatoire')\n                    .setCustomId('SkinButton-random')\n                    .setStyle(ButtonStyle.Primary)\n                    .setEmoji('🎲'),\n                ...(rows.at(0)?.components ?? []),\n            );\n\n        if (skin.gender === Gender.Women) {\n            rows.push(new ActionRowBuilder<ButtonBuilder>());\n        }\n\n        rows.at(rows.length - 1)?.addComponents(\n            new ButtonBuilder()\n                .setLabel(skin.gender === Gender.Men ? 'Femme' : 'Homme')\n                .setCustomId('SkinButton-gender')\n                .setStyle(ButtonStyle.Primary)\n                .setEmoji(skin.gender === Gender.Men ? '🚺' : '🚹'),\n            new ButtonBuilder().setLabel('Confirmer').setCustomId('SkinButton-confirm').setStyle(ButtonStyle.Success),\n        );\n\n        return rows;\n    }\n\n    /**\n     * Retourne une partie\n     */\n    public static getPart(attribute: keyof ISkin): Part | undefined {\n        return this.parts.find((p) => p.getAttribute() === attribute);\n    }\n\n    /**\n     * Génère une image en fonction d'un skin\n     */\n    private static async generateImage(skin: SkinModule): Promise<void> {\n        const canvas = createCanvas(350, 900);\n        const ctx = canvas.getContext('2d');\n\n        for await (const part of this.parts) {\n            await part.drawImage(skin, ctx);\n        }\n\n        // Génération de l'image\n        const buffer = canvas.toBuffer('image/png');\n        fs.writeFileSync(this.getSkinImagePath(skin), buffer);\n    }\n\n    /**\n     * Retourne le chemin de l'image en fonction du skin\n     */\n    private static getSkinImagePath(skin: SkinModule) {\n        const skinValues = Object.values(skin.toObject()).slice(0, -1);\n        return path.join('public/skin', skinValues.join('_') + '.png');\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d769b49ac6be19bb5ed6e513af31584c1ba91543"},"/usr/src/app/src/libs/utils.ts":{"path":"/usr/src/app/src/libs/utils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":57}},"2":{"start":{"line":4,"column":22},"end":{"line":8,"column":1}},"3":{"start":{"line":5,"column":17},"end":{"line":5,"column":92}},"4":{"start":{"line":5,"column":56},"end":{"line":5,"column":91}},"5":{"start":{"line":6,"column":20},"end":{"line":6,"column":65}},"6":{"start":{"line":7,"column":4},"end":{"line":7,"column":19}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":38}},"8":{"start":{"line":10,"column":24},"end":{"line":10,"column":80}},"9":{"start":{"line":10,"column":41},"end":{"line":10,"column":80}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":22},"end":{"line":4,"column":23}},"loc":{"start":{"line":4,"column":39},"end":{"line":8,"column":1}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":5,"column":49},"end":{"line":5,"column":50}},"loc":{"start":{"line":5,"column":56},"end":{"line":5,"column":91}},"line":5},"2":{"name":"(anonymous_2)","decl":{"start":{"line":10,"column":24},"end":{"line":10,"column":25}},"loc":{"start":{"line":10,"column":41},"end":{"line":10,"column":80}},"line":10}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"f":{"0":1,"1":2,"2":1},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/utils.ts","sources":["/usr/src/app/src/libs/utils.ts"],"names":[],"mappings":";;;AAAA,MAAM,aAAa,GAAG,CAAC,WAAoC,EAAU,EAAE;IACnE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACzF,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IAC9D,OAAO,OAAO,CAAC;AACnB,CAAC,CAAC;AAIO,sCAAa;AAFtB,MAAM,eAAe,GAAG,CAAC,WAAoC,EAAU,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC,CAAC;AAE1F,0CAAe","sourcesContent":["const randomEnumKey = (enumeration: { [s: string]: string }): string => {\n    const keys = Object.keys(enumeration).filter((k) => !(Math.abs(Number.parseInt(k)) + 1));\n    const enumKey = keys[Math.floor(Math.random() * keys.length)];\n    return enumKey;\n};\n\nconst randomEnumValue = (enumeration: { [s: string]: string }): string => enumeration[randomEnumKey(enumeration)];\n\nexport { randomEnumKey, randomEnumValue };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d4ca81703f47ccfc87418a7605d0cc049abf7ae1"},"/usr/src/app/src/libs/montage/Part.ts":{"path":"/usr/src/app/src/libs/montage/Part.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"25":{"start":{"line":26,"column":17},"end":{"line":26,"column":34}},"26":{"start":{"line":27,"column":15},"end":{"line":27,"column":48}},"27":{"start":{"line":28,"column":11},"end":{"line":28,"column":38}},"28":{"start":{"line":29,"column":13},"end":{"line":29,"column":42}},"29":{"start":{"line":30,"column":21},"end":{"line":30,"column":42}},"30":{"start":{"line":33,"column":8},"end":{"line":33,"column":35}},"31":{"start":{"line":34,"column":8},"end":{"line":34,"column":27}},"32":{"start":{"line":35,"column":8},"end":{"line":35,"column":33}},"33":{"start":{"line":38,"column":8},"end":{"line":38,"column":79}},"34":{"start":{"line":41,"column":8},"end":{"line":41,"column":30}},"35":{"start":{"line":44,"column":21},"end":{"line":44,"column":47}},"36":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"37":{"start":{"line":46,"column":12},"end":{"line":46,"column":21}},"38":{"start":{"line":48,"column":27},"end":{"line":48,"column":69}},"39":{"start":{"line":49,"column":8},"end":{"line":49,"column":60}},"40":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"41":{"start":{"line":53,"column":12},"end":{"line":53,"column":89}},"42":{"start":{"line":55,"column":27},"end":{"line":55,"column":100}},"43":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"44":{"start":{"line":57,"column":12},"end":{"line":57,"column":30}},"45":{"start":{"line":59,"column":8},"end":{"line":59,"column":20}},"46":{"start":{"line":62,"column":21},"end":{"line":62,"column":44}},"47":{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},"48":{"start":{"line":64,"column":12},"end":{"line":64,"column":19}},"49":{"start":{"line":66,"column":22},"end":{"line":66,"column":57}},"50":{"start":{"line":67,"column":8},"end":{"line":75,"column":9}},"51":{"start":{"line":68,"column":12},"end":{"line":68,"column":42}},"52":{"start":{"line":70,"column":13},"end":{"line":75,"column":9}},"53":{"start":{"line":71,"column":12},"end":{"line":71,"column":41}},"54":{"start":{"line":73,"column":13},"end":{"line":75,"column":9}},"55":{"start":{"line":74,"column":12},"end":{"line":74,"column":41}},"56":{"start":{"line":78,"column":18},"end":{"line":78,"column":19}},"57":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"58":{"start":{"line":80,"column":12},"end":{"line":80,"column":20}},"59":{"start":{"line":82,"column":27},"end":{"line":82,"column":69}},"60":{"start":{"line":83,"column":20},"end":{"line":83,"column":26}},"61":{"start":{"line":84,"column":8},"end":{"line":92,"column":9}},"62":{"start":{"line":85,"column":12},"end":{"line":85,"column":23}},"63":{"start":{"line":87,"column":13},"end":{"line":92,"column":9}},"64":{"start":{"line":88,"column":12},"end":{"line":88,"column":23}},"65":{"start":{"line":91,"column":12},"end":{"line":91,"column":25}},"66":{"start":{"line":95,"column":8},"end":{"line":106,"column":10}},"67":{"start":{"line":109,"column":0},"end":{"line":109,"column":23}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":32,"column":4},"end":{"line":32,"column":5}},"loc":{"start":{"line":32,"column":51},"end":{"line":36,"column":5}},"line":32},"7":{"name":"(anonymous_7)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":26},"end":{"line":39,"column":5}},"line":37},"8":{"name":"(anonymous_8)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":19},"end":{"line":42,"column":5}},"line":40},"9":{"name":"(anonymous_9)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":22},"end":{"line":50,"column":5}},"line":43},"10":{"name":"(anonymous_10)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":23},"end":{"line":60,"column":5}},"line":51},"11":{"name":"(anonymous_11)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":31},"end":{"line":76,"column":5}},"line":61},"12":{"name":"(anonymous_12)","decl":{"start":{"line":77,"column":4},"end":{"line":77,"column":5}},"loc":{"start":{"line":77,"column":25},"end":{"line":93,"column":5}},"line":77},"13":{"name":"(anonymous_13)","decl":{"start":{"line":94,"column":4},"end":{"line":94,"column":5}},"loc":{"start":{"line":94,"column":17},"end":{"line":107,"column":5}},"line":94}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":32,"column":34},"end":{"line":32,"column":49}},"type":"default-arg","locations":[{"start":{"line":32,"column":45},"end":{"line":32,"column":49}}],"line":32},"17":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{},"end":{}}],"line":45},"18":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{},"end":{}}],"line":52},"19":{"loc":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},{"start":{},"end":{}}],"line":56},"20":{"loc":{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},"type":"if","locations":[{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},{"start":{},"end":{}}],"line":63},"21":{"loc":{"start":{"line":67,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":75,"column":9}},{"start":{"line":70,"column":13},"end":{"line":75,"column":9}}],"line":67},"22":{"loc":{"start":{"line":70,"column":13},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":70,"column":13},"end":{"line":75,"column":9}},{"start":{"line":73,"column":13},"end":{"line":75,"column":9}}],"line":70},"23":{"loc":{"start":{"line":73,"column":13},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":73,"column":13},"end":{"line":75,"column":9}},{"start":{},"end":{}}],"line":73},"24":{"loc":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},{"start":{},"end":{}}],"line":79},"25":{"loc":{"start":{"line":84,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":84,"column":8},"end":{"line":92,"column":9}},{"start":{"line":87,"column":13},"end":{"line":92,"column":9}}],"line":84},"26":{"loc":{"start":{"line":87,"column":13},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":13},"end":{"line":92,"column":9}},{"start":{"line":90,"column":13},"end":{"line":92,"column":9}}],"line":87}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":59,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":10,"31":10,"32":10,"33":31,"34":55,"35":7,"36":7,"37":0,"38":7,"39":7,"40":6,"41":0,"42":6,"43":6,"44":6,"45":0,"46":10,"47":10,"48":1,"49":9,"50":9,"51":1,"52":8,"53":8,"54":0,"55":0,"56":2,"57":2,"58":0,"59":2,"60":2,"61":2,"62":0,"63":2,"64":0,"65":2,"66":8,"67":1},"f":{"0":119,"1":59,"2":0,"3":2,"4":0,"5":2,"6":10,"7":31,"8":55,"9":7,"10":6,"11":10,"12":2,"13":8},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[8],"17":[0,7],"18":[0,6],"19":[6,0],"20":[1,9],"21":[1,8],"22":[8,0],"23":[0,0],"24":[0,2],"25":[0,2],"26":[0,2]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/montage/Part.ts","sources":["/usr/src/app/src/libs/montage/Part.ts"],"names":[],"mappings":"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","sourcesContent":["import { CanvasRenderingContext2D, loadImage } from 'canvas';\nimport { Gender, ISkin, SkinModule } from '../../models/user/skin';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { ButtonBuilder, ButtonStyle } from 'discord.js';\n\nexport default class Part {\n    protected attribute: keyof ISkin;\n    protected label: string;\n    protected required: boolean;\n\n    constructor(attribute: keyof ISkin, label: string, required: boolean = true) {\n        this.attribute = attribute;\n        this.label = label;\n        this.required = required;\n    }\n\n    protected getFolderPath(gender: Gender) {\n        return path.join('images/character', gender, this.attribute + '_type');\n    }\n\n    public getAttribute(): string {\n        return this.attribute;\n    }\n\n    /**\n     * Retourne un nombre aléatoire\n     */\n    public getRandom(gender: Gender): number {\n        const path = this.getFolderPath(gender);\n\n        if (!fs.existsSync(path)) {\n            return 0;\n        }\n\n        const { length } = fs.readdirSync(this.getFolderPath(gender));\n\n        return Math.floor(Math.random() * (length - 1) + 1);\n    }\n\n    /**\n     * Retourne l'image\n     */\n    protected getImagePath(skin: SkinModule): string | null {\n        if (!(this.attribute in skin)) {\n            throw new Error(`L'attribut ${this.attribute} n'existe pas dans SkinModule`);\n        }\n\n        const image_path = path.join(this.getFolderPath(skin.gender), `${skin[this.attribute]}.png`);\n\n        if (fs.existsSync(image_path)) {\n            return image_path;\n        }\n\n        return null;\n    }\n\n    /**\n     * Dessine l'image sur le canvas\n     * @param skin\n     * @param ctx\n     */\n    public async drawImage(skin: SkinModule, ctx: CanvasRenderingContext2D): Promise<void> {\n        const path = this.getImagePath(skin);\n\n        if (path === null) {\n            return;\n        }\n\n        const image = await loadImage(path);\n\n        if (this.attribute === 'color') {\n            ctx.drawImage(image, 10, 180);\n        } else if (skin.gender === Gender.Men) {\n            ctx.drawImage(image, 65, 10);\n        } else if (skin.gender === Gender.Women) {\n            ctx.drawImage(image, 57, 20);\n        }\n    }\n\n    /**\n     * Clamp une valeur en fonction des possibilités pour cette partie\n     */\n    public clamp(value: number, gender: Gender) {\n        let min = 1;\n\n        if (!this.required) {\n            min = 0;\n        }\n\n        const { length } = fs.readdirSync(this.getFolderPath(gender));\n        const max = length;\n\n        if (value < min) {\n            return max;\n        } else if (value > max) {\n            return min;\n        } else {\n            return value;\n        }\n    }\n\n    /**\n     * Retourne les boutons pour choisir son apparence\n     */\n    public getButtons(): ButtonBuilder[] {\n        return [\n            new ButtonBuilder()\n                .setCustomId(`SkinButton-previous-${this.attribute}`)\n                .setLabel(`${this.label}`)\n                .setStyle(ButtonStyle.Secondary)\n                .setEmoji('⬅️'),\n\n            new ButtonBuilder()\n                .setCustomId(`SkinButton-next-${this.attribute}`)\n                .setLabel(`${this.label}`)\n                .setStyle(ButtonStyle.Secondary)\n                .setEmoji('➡️'),\n        ];\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8f4bae479da9ab84bb9e53a1f28aee5d97b407e5"},"/usr/src/app/src/libs/montage/PartWithColor.ts":{"path":"/usr/src/app/src/libs/montage/PartWithColor.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"25":{"start":{"line":26,"column":4},"end":{"line":26,"column":62}},"26":{"start":{"line":28,"column":0},"end":{"line":28,"column":62}},"27":{"start":{"line":29,"column":11},"end":{"line":29,"column":38}},"28":{"start":{"line":30,"column":13},"end":{"line":30,"column":42}},"29":{"start":{"line":31,"column":15},"end":{"line":31,"column":49}},"30":{"start":{"line":34,"column":18},"end":{"line":34,"column":19}},"31":{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},"32":{"start":{"line":36,"column":12},"end":{"line":36,"column":20}},"33":{"start":{"line":38,"column":27},"end":{"line":38,"column":85}},"34":{"start":{"line":39,"column":20},"end":{"line":39,"column":26}},"35":{"start":{"line":40,"column":8},"end":{"line":48,"column":9}},"36":{"start":{"line":41,"column":12},"end":{"line":41,"column":23}},"37":{"start":{"line":43,"column":13},"end":{"line":48,"column":9}},"38":{"start":{"line":44,"column":12},"end":{"line":44,"column":23}},"39":{"start":{"line":47,"column":12},"end":{"line":47,"column":25}},"40":{"start":{"line":51,"column":27},"end":{"line":51,"column":85}},"41":{"start":{"line":52,"column":8},"end":{"line":52,"column":60}},"42":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"43":{"start":{"line":56,"column":12},"end":{"line":56,"column":89}},"44":{"start":{"line":58,"column":27},"end":{"line":58,"column":117}},"45":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"46":{"start":{"line":60,"column":12},"end":{"line":60,"column":30}},"47":{"start":{"line":62,"column":8},"end":{"line":62,"column":20}},"48":{"start":{"line":65,"column":0},"end":{"line":65,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":56},"end":{"line":25,"column":57}},"loc":{"start":{"line":25,"column":71},"end":{"line":27,"column":1}},"line":25},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":25},"end":{"line":49,"column":5}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":22},"end":{"line":53,"column":5}},"line":50},"9":{"name":"(anonymous_9)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":23},"end":{"line":63,"column":5}},"line":54}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":27}},{"start":{"line":25,"column":31},"end":{"line":25,"column":51}},{"start":{"line":25,"column":56},"end":{"line":27,"column":1}}],"line":25},"17":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":61}},"type":"cond-expr","locations":[{"start":{"line":26,"column":37},"end":{"line":26,"column":40}},{"start":{"line":26,"column":43},"end":{"line":26,"column":61}}],"line":26},"18":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":33}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":15}},{"start":{"line":26,"column":19},"end":{"line":26,"column":33}}],"line":26},"19":{"loc":{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":37,"column":9}},{"start":{},"end":{}}],"line":35},"20":{"loc":{"start":{"line":40,"column":8},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":48,"column":9}},{"start":{"line":43,"column":13},"end":{"line":48,"column":9}}],"line":40},"21":{"loc":{"start":{"line":43,"column":13},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":13},"end":{"line":48,"column":9}},{"start":{"line":46,"column":13},"end":{"line":48,"column":9}}],"line":43},"22":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{},"end":{}}],"line":55},"23":{"loc":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},{"start":{},"end":{}}],"line":59}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":16,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":2,"31":2,"32":0,"33":2,"34":2,"35":2,"36":0,"37":2,"38":0,"39":2,"40":3,"41":3,"42":3,"43":0,"44":3,"45":3,"46":3,"47":0,"48":1},"f":{"0":119,"1":16,"2":0,"3":2,"4":0,"5":2,"6":1,"7":2,"8":3,"9":3},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[1,1,1],"17":[1,0],"18":[1,1],"19":[0,2],"20":[0,2],"21":[0,2],"22":[0,3],"23":[3,0]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/montage/PartWithColor.ts","sources":["/usr/src/app/src/libs/montage/PartWithColor.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,uCAAyB;AACzB,2CAA6B;AAC7B,kDAA0B;AAE1B,MAAqB,aAAc,SAAQ,cAAI;IAIpC,KAAK,CAAC,KAAa,EAAE,MAAc;QACtC,IAAI,GAAG,GAAG,CAAC,CAAC;QAEZ,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACjB,GAAG,GAAG,CAAC,CAAC;QACZ,CAAC;QAED,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QAC9E,MAAM,GAAG,GAAG,MAAM,CAAC;QAEnB,IAAI,KAAK,GAAG,GAAG,EAAE,CAAC;YACd,OAAO,GAAG,CAAC;QACf,CAAC;aAAM,IAAI,KAAK,GAAG,GAAG,EAAE,CAAC;YACrB,OAAO,GAAG,CAAC;QACf,CAAC;aAAM,CAAC;YACJ,OAAO,KAAK,CAAC;QACjB,CAAC;IACL,CAAC;IAKM,SAAS,CAAC,MAAc;QAC3B,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QAE9E,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IACxD,CAAC;IAKS,YAAY,CAAC,IAAgB;QACnC,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,EAAE,CAAC;YAC5B,MAAM,IAAI,KAAK,CAAC,cAAc,IAAI,CAAC,SAAS,+BAA+B,CAAC,CAAC;QACjF,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,KAAK,EAAE,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAE9G,IAAI,EAAE,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,CAAC;YAC5B,OAAO,UAAU,CAAC;QACtB,CAAC;QAED,OAAO,IAAI,CAAC;IAChB,CAAC;CACJ;AAhDD,gCAgDC","sourcesContent":["import { Gender, SkinModule } from '../../models/user/skin';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport Part from './Part';\n\nexport default class PartWithColor extends Part {\n    /**\n     * Clamp une valeur en fonction des possibilités pour cette partie\n     */\n    public clamp(value: number, gender: Gender) {\n        let min = 1;\n\n        if (!this.required) {\n            min = 0;\n        }\n\n        const { length } = fs.readdirSync(path.join(this.getFolderPath(gender), '1'));\n        const max = length;\n\n        if (value < min) {\n            return max;\n        } else if (value > max) {\n            return min;\n        } else {\n            return value;\n        }\n    }\n\n    /**\n     * Retourne un nombre aléatoire\n     */\n    public getRandom(gender: Gender): number {\n        const { length } = fs.readdirSync(path.join(this.getFolderPath(gender), '1'));\n\n        return Math.floor(Math.random() * (length - 1) + 1);\n    }\n\n    /**\n     * Retourne l'image\n     */\n    protected getImagePath(skin: SkinModule): string | null {\n        if (!(this.attribute in skin)) {\n            throw new Error(`L'attribut ${this.attribute} n'existe pas dans SkinModule`);\n        }\n\n        const image_path = path.join(this.getFolderPath(skin.gender), `${skin.color}`, `${skin[this.attribute]}.png`);\n\n        if (fs.existsSync(image_path)) {\n            return image_path;\n        }\n\n        return null;\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"13ee53d182c79ff6299ee0a97de8eaa8b334fd14"},"/usr/src/app/src/libs/montage/PartHairBack.ts":{"path":"/usr/src/app/src/libs/montage/PartHairBack.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"25":{"start":{"line":26,"column":4},"end":{"line":26,"column":62}},"26":{"start":{"line":28,"column":0},"end":{"line":28,"column":62}},"27":{"start":{"line":29,"column":15},"end":{"line":29,"column":49}},"28":{"start":{"line":30,"column":11},"end":{"line":30,"column":38}},"29":{"start":{"line":31,"column":13},"end":{"line":31,"column":42}},"30":{"start":{"line":34,"column":8},"end":{"line":34,"column":40}},"31":{"start":{"line":37,"column":27},"end":{"line":37,"column":92}},"32":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"33":{"start":{"line":39,"column":12},"end":{"line":39,"column":30}},"34":{"start":{"line":41,"column":8},"end":{"line":41,"column":20}},"35":{"start":{"line":44,"column":0},"end":{"line":44,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":56},"end":{"line":25,"column":57}},"loc":{"start":{"line":25,"column":71},"end":{"line":27,"column":1}},"line":25},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":18},"end":{"line":35,"column":5}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":23},"end":{"line":42,"column":5}},"line":36}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":27}},{"start":{"line":25,"column":31},"end":{"line":25,"column":51}},{"start":{"line":25,"column":56},"end":{"line":27,"column":1}}],"line":25},"17":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":61}},"type":"cond-expr","locations":[{"start":{"line":26,"column":37},"end":{"line":26,"column":40}},{"start":{"line":26,"column":43},"end":{"line":26,"column":61}}],"line":26},"18":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":33}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":15}},{"start":{"line":26,"column":19},"end":{"line":26,"column":33}}],"line":26},"19":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{},"end":{}}],"line":38}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":2,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":0,"34":1,"35":1},"f":{"0":119,"1":2,"2":0,"3":2,"4":0,"5":2,"6":1,"7":1,"8":1},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[1,1,1],"17":[1,0],"18":[1,1],"19":[0,1]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/montage/PartHairBack.ts","sources":["/usr/src/app/src/libs/montage/PartHairBack.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,kDAA0B;AAE1B,uCAAyB;AACzB,2CAA6B;AAE7B,MAAqB,YAAa,SAAQ,cAAI;IAC1C;QACI,KAAK,CAAC,WAA0B,EAAE,WAAW,CAAC,CAAC;IACnD,CAAC;IAKS,YAAY,CAAC,IAAgB;QACnC,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAErF,IAAI,EAAE,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,CAAC;YAC5B,OAAO,UAAU,CAAC;QACtB,CAAC;QAED,OAAO,IAAI,CAAC;IAChB,CAAC;CACJ;AAjBD,+BAiBC","sourcesContent":["import Part from './Part';\nimport { ISkin, SkinModule } from '../../models/user/skin';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nexport default class PartHairBack extends Part {\n    constructor() {\n        super('hair_back' as keyof ISkin, 'hair_back');\n    }\n\n    /**\n     * Retourne l'image\n     */\n    protected getImagePath(skin: SkinModule): string | null {\n        const image_path = path.join(this.getFolderPath(skin.gender), `${skin['hair']}.png`);\n\n        if (fs.existsSync(image_path)) {\n            return image_path;\n        }\n\n        return null;\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b3799c3ace0504b7a0098b964be640fd04c05497"},"/usr/src/app/src/models/user/missions.ts":{"path":"/usr/src/app/src/models/user/missions.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":56}},"4":{"start":{"line":7,"column":19},"end":{"line":7,"column":38}},"5":{"start":{"line":8,"column":18},"end":{"line":8,"column":46}},"6":{"start":{"line":9,"column":18},"end":{"line":9,"column":46}},"7":{"start":{"line":10,"column":24},"end":{"line":10,"column":77}},"8":{"start":{"line":11,"column":0},"end":{"line":19,"column":3}},"9":{"start":{"line":20,"column":22},"end":{"line":20,"column":79}},"10":{"start":{"line":21,"column":0},"end":{"line":21,"column":38}},"11":{"start":{"line":22,"column":0},"end":{"line":33,"column":2}},"12":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"13":{"start":{"line":24,"column":8},"end":{"line":24,"column":28}},"14":{"start":{"line":26,"column":4},"end":{"line":31,"column":5}},"15":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"16":{"start":{"line":27,"column":21},"end":{"line":27,"column":22}},"17":{"start":{"line":28,"column":12},"end":{"line":28,"column":43}},"18":{"start":{"line":30,"column":8},"end":{"line":30,"column":26}},"19":{"start":{"line":32,"column":4},"end":{"line":32,"column":25}},"20":{"start":{"line":34,"column":0},"end":{"line":48,"column":2}},"21":{"start":{"line":35,"column":15},"end":{"line":35,"column":98}},"22":{"start":{"line":36,"column":15},"end":{"line":36,"column":82}},"23":{"start":{"line":37,"column":19},"end":{"line":37,"column":43}},"24":{"start":{"line":38,"column":21},"end":{"line":38,"column":75}},"25":{"start":{"line":39,"column":18},"end":{"line":46,"column":6}},"26":{"start":{"line":47,"column":4},"end":{"line":47,"column":32}},"27":{"start":{"line":49,"column":0},"end":{"line":61,"column":2}},"28":{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},"29":{"start":{"line":51,"column":8},"end":{"line":51,"column":54}},"30":{"start":{"line":53,"column":20},"end":{"line":53,"column":36}},"31":{"start":{"line":54,"column":4},"end":{"line":58,"column":6}},"32":{"start":{"line":57,"column":37},"end":{"line":57,"column":69}},"33":{"start":{"line":59,"column":4},"end":{"line":59,"column":31}},"34":{"start":{"line":60,"column":4},"end":{"line":60,"column":75}},"35":{"start":{"line":62,"column":0},"end":{"line":70,"column":2}},"36":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"37":{"start":{"line":64,"column":8},"end":{"line":64,"column":54}},"38":{"start":{"line":66,"column":4},"end":{"line":66,"column":42}},"39":{"start":{"line":67,"column":4},"end":{"line":67,"column":37}},"40":{"start":{"line":68,"column":4},"end":{"line":68,"column":24}},"41":{"start":{"line":69,"column":4},"end":{"line":69,"column":61}},"42":{"start":{"line":71,"column":0},"end":{"line":80,"column":2}},"43":{"start":{"line":72,"column":4},"end":{"line":72,"column":47}},"44":{"start":{"line":73,"column":4},"end":{"line":73,"column":41}},"45":{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},"46":{"start":{"line":75,"column":8},"end":{"line":75,"column":53}},"47":{"start":{"line":77,"column":4},"end":{"line":77,"column":42}},"48":{"start":{"line":78,"column":4},"end":{"line":78,"column":35}},"49":{"start":{"line":79,"column":4},"end":{"line":79,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":22,"column":45},"end":{"line":22,"column":46}},"loc":{"start":{"line":22,"column":67},"end":{"line":33,"column":1}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":34,"column":47},"end":{"line":34,"column":48}},"loc":{"start":{"line":34,"column":69},"end":{"line":48,"column":1}},"line":34},"3":{"name":"(anonymous_3)","decl":{"start":{"line":49,"column":48},"end":{"line":49,"column":49}},"loc":{"start":{"line":49,"column":83},"end":{"line":61,"column":1}},"line":49},"4":{"name":"(anonymous_4)","decl":{"start":{"line":57,"column":31},"end":{"line":57,"column":32}},"loc":{"start":{"line":57,"column":37},"end":{"line":57,"column":69}},"line":57},"5":{"name":"(anonymous_5)","decl":{"start":{"line":62,"column":52},"end":{"line":62,"column":53}},"loc":{"start":{"line":62,"column":64},"end":{"line":70,"column":1}},"line":62},"6":{"name":"(anonymous_6)","decl":{"start":{"line":71,"column":45},"end":{"line":71,"column":46}},"loc":{"start":{"line":71,"column":77},"end":{"line":80,"column":1}},"line":71}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{},"end":{}}],"line":23},"4":{"loc":{"start":{"line":26,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":31,"column":5}},{"start":{},"end":{}}],"line":26},"5":{"loc":{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},{"start":{},"end":{}}],"line":50},"6":{"loc":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},{"start":{},"end":{}}],"line":63},"7":{"loc":{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},"type":"if","locations":[{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},{"start":{},"end":{}}],"line":74}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":2,"13":1,"14":1,"15":1,"16":1,"17":5,"18":1,"19":1,"20":1,"21":6,"22":6,"23":6,"24":6,"25":6,"26":6,"27":1,"28":2,"29":0,"30":2,"31":2,"32":0,"33":2,"34":2,"35":1,"36":1,"37":0,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":0,"47":1,"48":1,"49":1},"f":{"0":1,"1":2,"2":6,"3":2,"4":0,"5":1,"6":1},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[1,1],"4":[1,0],"5":[0,2],"6":[0,1],"7":[0,1]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/missions.ts","sources":["/usr/src/app/src/models/user/missions.ts"],"names":[],"mappings":";;;;;;AAAA,uCAAkE;AAElE,+CAAyE;AACzE,+CAA2D;AAG3D,8EAA8C;AAoBjC,QAAA,cAAc,GAAW,IAAI,iBAAM,CAAsC;IAClF,QAAQ,EAAE;QACN,IAAI,EAAE,CAAC,uBAAa,CAAC;QACrB,QAAQ,EAAE,IAAI;KACjB;IACD,OAAO,EAAE;QACL,IAAI,EAAE,uBAAa;KACtB;CACJ,CAAC,CAAC;AAEH,MAAM,aAAa,GAAG,IAAA,gBAAK,EAA4B,UAAU,EAAE,sBAAc,CAAC,CAAC;AAE1E,sCAAa;AAEtB,sBAAc,CAAC,OAAO,CAAC,WAAW,GAAG,KAAK,WAAW,IAAU;IAC3D,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,OAAO,IAAI,CAAC,OAAO,CAAC;IACxB,CAAC;IACD,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YACzB,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QACnC,CAAC;QAED,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;IACtB,CAAC;IACD,OAAO,IAAI,CAAC,QAAQ,CAAC;AACzB,CAAC,CAAC;AAEF,sBAAc,CAAC,OAAO,CAAC,aAAa,GAAG,KAAK,WAAW,IAAU;IAC7D,IAAI,IAAI,GAAG,uBAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,uBAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IAC3D,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC;IAE/E,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC;IACxC,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG,EAAE,CAAC,GAAG,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;IAExE,IAAI,OAAO,GAAG,MAAM,sBAAY,CAAC,MAAM,CAAC;QACpC,KAAK,EAAE,IAAI,CAAC,KAAK;QACjB,IAAI,EAAE,IAAI,CAAC,WAAW;QACtB,IAAI,EAAE,IAAI,CAAC,IAAI;QACf,IAAI,EAAE,IAAI;QACV,QAAQ,EAAE,QAAQ;QAClB,UAAU,EAAE,UAAU;KACzB,CAAC,CAAC;IACH,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAChC,CAAC,CAAC;AAEF,sBAAc,CAAC,OAAO,CAAC,cAAc,GAAG,KAAK,WACzC,CAAS,EACT,IAAU,EACV,QAA6C;IAE7C,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,OAAO,sCAAsC,CAAC;IAClD,CAAC;IAED,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACjC,IAAI,CAAC,OAAO,GAAG;QACX,GAAG,OAAO;QACV,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE;QACnB,UAAU,EAAE,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,OAAO,CAAC,IAAI,GAAG,EAAE,GAAG,IAAI,CAAC;KAC3F,CAAC;IACF,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAC3B,OAAO,6CAA6C,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC;AAC3E,CAAC,CAAC;AAEF,sBAAc,CAAC,OAAO,CAAC,kBAAkB,GAAG;IACxC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAChB,OAAO,sCAAsC,CAAC;IAClD,CAAC;IAED,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IACtC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACjC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACpB,OAAO,iDAAiD,CAAC;AAC7D,CAAC,CAAC;AAEF,sBAAc,CAAC,OAAO,CAAC,WAAW,GAAG,KAAK,WAAW,IAAU,EAAE,QAA6C;IAC1G,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAC3C,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;IAErC,IAAI,QAAQ,EAAE,CAAC;QACX,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACjD,CAAC;IAED,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IACtC,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;IAC/B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACxB,CAAC,CAAC","sourcesContent":["import { HydratedDocument, model, Model, Schema } from 'mongoose';\nimport { ButtonInteraction, userMention, Message } from 'discord.js';\nimport { Mission, MissionModel, MissionSchema } from './mission/mission';\nimport { Current, CurrentSchema } from './mission/current';\nimport { User } from './user';\n\nimport datas from '../../datas/missions.json';\n\ninterface IMissions {\n    missions: Mission[];\n    current: Current;\n}\n\ninterface IMissionsMethods {\n    getMissions(user: User): Promise<Mission[] | Current>;\n    confirmMission(n: Number, user: User, callBack?: (xp: number, gold: number) => void): Promise<string>;\n    stopCurrentMission(): string;\n    sendRewards(user: User, callBack?: (xp: number, gold: number) => void): Promise<void>;\n}\n\ninterface IMissionsModel extends Model<IMissions, object, IMissionsMethods> {\n    static(): void;\n}\n\nexport type Missions = HydratedDocument<IMissions, IMissionsMethods>;\n\nexport const MissionsSchema: Schema = new Schema<IMissions, object, IMissionsMethods>({\n    missions: {\n        type: [MissionSchema],\n        required: true,\n    },\n    current: {\n        type: CurrentSchema,\n    },\n});\n\nconst MissionsModel = model<IMissions, IMissionsModel>('Missions', MissionsSchema);\n\nexport { MissionsModel };\n\nMissionsSchema.methods.getMissions = async function (user: User): Promise<Mission[] | Current> {\n    if (this.current) {\n        return this.current;\n    }\n    if (this.missions.length === 0) {\n        for (let i = 0; i < 5; i++) {\n            await this.createMission(user);\n        }\n\n        await user.save();\n    }\n    return this.missions;\n};\n\nMissionsSchema.methods.createMission = async function (user: User) {\n    let data = datas[Math.floor(Math.random() * datas.length)];\n    let time = data.rank * Math.floor(Math.random() * 100) + 100 * (data.rank - 1);\n\n    let rewardXp = Math.floor(time * 0.507);\n    let rewardGold = Math.floor((user.experience.level / 10) * (time / 50));\n\n    let mission = await MissionModel.create({\n        title: data.title,\n        desc: data.description,\n        rank: data.rank,\n        time: time,\n        rewardXp: rewardXp,\n        rewardGold: rewardGold,\n    });\n    this.missions.push(mission);\n};\n\nMissionsSchema.methods.confirmMission = async function (\n    n: string,\n    user: User,\n    callBack?: (xp: number, gold: number) => void,\n): Promise<string> {\n    if (this.current) {\n        return 'Vous avez déjà une mission en cours.';\n    }\n\n    const mission = this.missions[n];\n    this.current = {\n        ...mission,\n        startAt: Date.now(),\n        timeout_id: setTimeout(() => this.sendRewards(user, callBack), mission.time * 60 * 1000),\n    };\n    this.missions.splice(n, 1);\n    return `Vous avez décidé de réaliser la mission n°${parseInt(n) + 1}.`;\n};\n\nMissionsSchema.methods.stopCurrentMission = function (): string {\n    if (!this.current) {\n        return \"Vous n'avez pas de mission en cours.\";\n    }\n\n    clearTimeout(this.current.timeout_id);\n    this.missions.push(this.current);\n    this.current = null;\n    return `Vous avez décidé d'annuler la mission en cours.`;\n};\n\nMissionsSchema.methods.sendRewards = async function (user: User, callBack?: (xp: number, gold: number) => void) {\n    user.experience.add(this.current.rewardXp);\n    user.gold += this.current.rewardGold;\n\n    if (callBack) {\n        callBack(this.current.xp, this.current.gold);\n    }\n\n    clearTimeout(this.current.timeout_id);\n    await this.createMission(user);\n    this.current = null;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"294d084ba3985654eac8ee5e2cddad853bbf742e"},"/usr/src/app/src/models/user/mission/mission.ts":{"path":"/usr/src/app/src/models/user/mission/mission.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":54}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":30,"column":3}},"4":{"start":{"line":31,"column":21},"end":{"line":31,"column":76}},"5":{"start":{"line":32,"column":0},"end":{"line":32,"column":36}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/mission/mission.ts","sources":["/usr/src/app/src/models/user/mission/mission.ts"],"names":[],"mappings":";;;AAAA,uCAAkE;AAqBrD,QAAA,aAAa,GAAW,IAAI,iBAAM,CAAoC;IAC/E,KAAK,EAAE;QACH,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,QAAQ,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;CACJ,CAAC,CAAC;AAEH,MAAM,YAAY,GAAG,IAAA,gBAAK,EAA0B,SAAS,EAAE,qBAAa,CAAC,CAAC;AAErE,oCAAY","sourcesContent":["import { HydratedDocument, model, Model, Schema } from 'mongoose';\n\nexport interface IMission {\n    title: string;\n    desc: string;\n    rank: number;\n    time: number;\n    rewardXp: number;\n    rewardGold: number;\n}\n\ninterface IMissionMethods {\n    static(): void;\n}\n\ninterface IMissionModel extends Model<IMission, object, IMissionMethods> {\n    static(): void;\n}\n\nexport type Mission = HydratedDocument<IMission, IMissionMethods>;\n\nexport const MissionSchema: Schema = new Schema<IMission, object, IMissionMethods>({\n    title: {\n        type: String,\n        required: true,\n    },\n    desc: {\n        type: String,\n        required: true,\n    },\n    rank: {\n        type: Number,\n        required: true,\n    },\n    time: {\n        type: Number,\n        required: true,\n    },\n    rewardXp: {\n        type: Number,\n        required: true,\n    },\n    rewardGold: {\n        type: Number,\n        required: true,\n    },\n});\n\nconst MissionModel = model<IMission, IMissionModel>('Mission', MissionSchema);\n\nexport { MissionModel };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0e5319d8eb8424af683d4bfa1b221f6e1d35a25"},"/usr/src/app/src/models/user/mission/current.ts":{"path":"/usr/src/app/src/models/user/mission/current.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":18},"end":{"line":5,"column":38}},"4":{"start":{"line":6,"column":0},"end":{"line":15,"column":3}},"5":{"start":{"line":16,"column":0},"end":{"line":16,"column":55}},"6":{"start":{"line":17,"column":0},"end":{"line":26,"column":2}},"7":{"start":{"line":18,"column":16},"end":{"line":18,"column":26}},"8":{"start":{"line":19,"column":17},"end":{"line":19,"column":55}},"9":{"start":{"line":20,"column":20},"end":{"line":20,"column":50}},"10":{"start":{"line":21,"column":29},"end":{"line":21,"column":48}},"11":{"start":{"line":22,"column":16},"end":{"line":24,"column":30}},"12":{"start":{"line":25,"column":4},"end":{"line":25,"column":15}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":17,"column":49},"end":{"line":17,"column":50}},"loc":{"start":{"line":17,"column":61},"end":{"line":26,"column":1}},"line":17}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/mission/current.ts","sources":["/usr/src/app/src/models/user/mission/current.ts"],"names":[],"mappings":";;;AAAA,uCAAkE;AAClE,uCAAoD;AAavC,QAAA,aAAa,GAAW,IAAI,iBAAM,CAAoC;IAC/E,OAAO,EAAE;QACL,IAAI,EAAE,IAAI;QACV,QAAQ,EAAE,IAAI;KACjB;IACD,UAAU,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;CACJ,CAAC,CAAC;AAGH,qBAAa,CAAC,GAAG,CAAC,uBAAa,CAAC,GAAG,CAAC,CAAC;AAErC,qBAAa,CAAC,OAAO,CAAC,gBAAgB,GAAG;IACrC,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;IACvB,MAAM,IAAI,GAAG,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IAEpD,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;IAC/C,MAAM,gBAAgB,GAAG,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC;IAE7C,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,EAAE,CAAC;SAChF,QAAQ,EAAE;SACV,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC;IAC3B,OAAO,GAAG,CAAC;AACf,CAAC,CAAC","sourcesContent":["import { HydratedDocument, model, Model, Schema } from 'mongoose';\nimport { IMission, MissionSchema } from './mission';\n\ninterface ICurrent extends IMission {\n    startAt: Date;\n    timeout_id: number;\n}\n\ninterface ICurrentMethods {\n    getRemainingTime(): String;\n}\n\nexport type Current = HydratedDocument<ICurrent, ICurrentMethods>;\n\nexport const CurrentSchema: Schema = new Schema<ICurrent, object, ICurrentMethods>({\n    startAt: {\n        type: Date,\n        required: true,\n    },\n    timeout_id: {\n        type: Number,\n        required: true,\n    },\n});\n\n// Ajouter les champs de MissionSchema dans CurrentSchema\nCurrentSchema.add(MissionSchema.obj);\n\nCurrentSchema.methods.getRemainingTime = function (): string {\n    const now = new Date();\n    const diff = now.getTime() - this.startAt.getTime();\n\n    const diffMin = Math.floor(diff / (1000 * 60));\n    const remainingTimeMin = this.time - diffMin;\n\n    const res = `${Math.floor(remainingTimeMin / 60)}h${Math.floor(remainingTimeMin % 60)\n        .toString()\n        .padStart(2, '0')}min`;\n    return res;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1268f40b93a7ad10429f1f27aded489d1b562ead"},"/usr/src/app/src/models/user/inventory.ts":{"path":"/usr/src/app/src/models/user/inventory.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":15},"end":{"line":5,"column":38}},"4":{"start":{"line":6,"column":0},"end":{"line":12,"column":3}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/inventory.ts","sources":["/usr/src/app/src/models/user/inventory.ts"],"names":[],"mappings":";;;AAAA,uCAAoD;AACpD,uCAAqD;AAYxC,QAAA,eAAe,GAAW,IAAI,iBAAM,CAAwC;IACrF,KAAK,EAAE;QACH,IAAI,EAAE,CAAC,iBAAU,CAAC;QAClB,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,EAAE;KACd;CACJ,CAAC,CAAC","sourcesContent":["import { HydratedDocument, Schema } from 'mongoose';\nimport { ItemModel, ItemSchema } from '../item/item';\n\n// Données du document\ninterface IInventory {\n    items: ItemModel[];\n}\n\n// Méthodes sur l'instance\ninterface IInventoryMethods {}\n\nexport type InventoryModule = HydratedDocument<IInventory, IInventoryMethods>;\n\nexport const InventorySchema: Schema = new Schema<IInventory, object, IInventoryMethods>({\n    items: {\n        type: [ItemSchema],\n        required: true,\n        default: [],\n    },\n});\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"70ab69f54b1d503c80d945e25c3839d0fbf22608"},"/usr/src/app/src/models/item/item.ts":{"path":"/usr/src/app/src/models/item/item.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":28}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":19},"end":{"line":5,"column":40}},"4":{"start":{"line":6,"column":0},"end":{"line":17,"column":3}},"5":{"start":{"line":18,"column":0},"end":{"line":18,"column":54}},"6":{"start":{"line":19,"column":0},"end":{"line":21,"column":2}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":19,"column":42},"end":{"line":19,"column":43}},"loc":{"start":{"line":19,"column":54},"end":{"line":21,"column":1}},"line":19}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2},"f":{"0":2},"b":{},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/item/item.ts","sources":["/usr/src/app/src/models/item/item.ts"],"names":[],"mappings":";;;AAAA,uCAAoD;AACpD,yCAAuD;AAc1C,QAAA,UAAU,GAAW,IAAI,iBAAM,CACxC;IACI,MAAM,EAAE;QACJ,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;IACD,KAAK,EAAE;QACH,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACjB;CACJ,EACD;IACI,UAAU,EAAE,IAAI;CACnB,CACJ,CAAC;AAEF,kBAAU,CAAC,GAAG,CAAC,yBAAc,CAAC,GAAG,CAAC,CAAC;AAEnC,kBAAU,CAAC,OAAO,CAAC,YAAY,GAAG;IAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;AACrC,CAAC,CAAC","sourcesContent":["import { HydratedDocument, Schema } from 'mongoose';\nimport { BaseItemSchema, IBaseItem } from './baseItem';\n\ninterface IItem extends IBaseItem {\n    rarity: string;\n    price: number;\n}\n\n// Méthodes sur l'instance\ninterface IItemMethods {\n    getSellPrice: () => number;\n}\n\nexport type ItemModel = HydratedDocument<IItem, IItemMethods>;\n\nexport const ItemSchema: Schema = new Schema<IItem, object, IItemMethods>(\n    {\n        rarity: {\n            type: String,\n            required: true,\n        },\n        price: {\n            type: Number,\n            required: true,\n        },\n    },\n    {\n        timestamps: true,\n    },\n);\n\nItemSchema.add(BaseItemSchema.obj);\n\nItemSchema.methods.getSellPrice = function (): number {\n    return Math.ceil(this.price / 2);\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fad27a4c08112bfb3f6b4c5570da90e58801a9ef"},"/usr/src/app/src/models/item/baseItem.ts":{"path":"/usr/src/app/src/models/item/baseItem.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"25":{"start":{"line":26,"column":4},"end":{"line":26,"column":62}},"26":{"start":{"line":28,"column":0},"end":{"line":28,"column":62}},"27":{"start":{"line":29,"column":0},"end":{"line":29,"column":56}},"28":{"start":{"line":30,"column":19},"end":{"line":30,"column":38}},"29":{"start":{"line":31,"column":21},"end":{"line":31,"column":50}},"30":{"start":{"line":32,"column":11},"end":{"line":32,"column":38}},"31":{"start":{"line":33,"column":13},"end":{"line":33,"column":42}},"32":{"start":{"line":34,"column":19},"end":{"line":34,"column":66}},"33":{"start":{"line":35,"column":0},"end":{"line":67,"column":3}},"34":{"start":{"line":63,"column":24},"end":{"line":63,"column":26}},"35":{"start":{"line":68,"column":0},"end":{"line":118,"column":2}},"36":{"start":{"line":69,"column":20},"end":{"line":69,"column":56}},"37":{"start":{"line":70,"column":4},"end":{"line":72,"column":5}},"38":{"start":{"line":71,"column":8},"end":{"line":71,"column":15}},"39":{"start":{"line":73,"column":4},"end":{"line":73,"column":37}},"40":{"start":{"line":74,"column":18},"end":{"line":74,"column":48}},"41":{"start":{"line":75,"column":20},"end":{"line":75,"column":59}},"42":{"start":{"line":75,"column":40},"end":{"line":75,"column":58}},"43":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"44":{"start":{"line":77,"column":8},"end":{"line":77,"column":46}},"45":{"start":{"line":79,"column":26},"end":{"line":88,"column":5}},"46":{"start":{"line":89,"column":4},"end":{"line":117,"column":7}},"47":{"start":{"line":90,"column":22},"end":{"line":90,"column":65}},"48":{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},"49":{"start":{"line":92,"column":12},"end":{"line":92,"column":19}},"50":{"start":{"line":94,"column":21},"end":{"line":94,"column":29}},"51":{"start":{"line":95,"column":21},"end":{"line":95,"column":29}},"52":{"start":{"line":96,"column":33},"end":{"line":96,"column":83}},"53":{"start":{"line":97,"column":31},"end":{"line":97,"column":81}},"54":{"start":{"line":98,"column":27},"end":{"line":98,"column":72}},"55":{"start":{"line":99,"column":8},"end":{"line":99,"column":33}},"56":{"start":{"line":100,"column":22},"end":{"line":100,"column":66}},"57":{"start":{"line":101,"column":22},"end":{"line":104,"column":59}},"58":{"start":{"line":104,"column":40},"end":{"line":104,"column":58}},"59":{"start":{"line":105,"column":20},"end":{"line":110,"column":10}},"60":{"start":{"line":111,"column":8},"end":{"line":114,"column":9}},"61":{"start":{"line":112,"column":12},"end":{"line":112,"column":43}},"62":{"start":{"line":113,"column":12},"end":{"line":113,"column":47}},"63":{"start":{"line":115,"column":8},"end":{"line":115,"column":51}},"64":{"start":{"line":116,"column":8},"end":{"line":116,"column":25}},"65":{"start":{"line":119,"column":0},"end":{"line":125,"column":2}},"66":{"start":{"line":120,"column":16},"end":{"line":123,"column":15}},"67":{"start":{"line":124,"column":4},"end":{"line":124,"column":48}},"68":{"start":{"line":124,"column":26},"end":{"line":124,"column":46}},"69":{"start":{"line":126,"column":22},"end":{"line":126,"column":79}},"70":{"start":{"line":127,"column":0},"end":{"line":127,"column":38}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":56},"end":{"line":25,"column":57}},"loc":{"start":{"line":25,"column":71},"end":{"line":27,"column":1}},"line":25},"7":{"name":"(anonymous_7)","decl":{"start":{"line":63,"column":17},"end":{"line":63,"column":18}},"loc":{"start":{"line":63,"column":24},"end":{"line":63,"column":26}},"line":63},"8":{"name":"(anonymous_8)","decl":{"start":{"line":68,"column":44},"end":{"line":68,"column":45}},"loc":{"start":{"line":68,"column":76},"end":{"line":118,"column":1}},"line":68},"9":{"name":"(anonymous_9)","decl":{"start":{"line":75,"column":33},"end":{"line":75,"column":34}},"loc":{"start":{"line":75,"column":40},"end":{"line":75,"column":58}},"line":75},"10":{"name":"(anonymous_10)","decl":{"start":{"line":89,"column":18},"end":{"line":89,"column":19}},"loc":{"start":{"line":89,"column":31},"end":{"line":117,"column":5}},"line":89},"11":{"name":"(anonymous_11)","decl":{"start":{"line":104,"column":30},"end":{"line":104,"column":31}},"loc":{"start":{"line":104,"column":40},"end":{"line":104,"column":58}},"line":104},"12":{"name":"(anonymous_12)","decl":{"start":{"line":119,"column":51},"end":{"line":119,"column":52}},"loc":{"start":{"line":119,"column":68},"end":{"line":125,"column":1}},"line":119},"13":{"name":"(anonymous_13)","decl":{"start":{"line":124,"column":19},"end":{"line":124,"column":20}},"loc":{"start":{"line":124,"column":26},"end":{"line":124,"column":46}},"line":124}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":25,"column":22},"end":{"line":27,"column":1}},"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":27}},{"start":{"line":25,"column":31},"end":{"line":25,"column":51}},{"start":{"line":25,"column":56},"end":{"line":27,"column":1}}],"line":25},"17":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":61}},"type":"cond-expr","locations":[{"start":{"line":26,"column":37},"end":{"line":26,"column":40}},{"start":{"line":26,"column":43},"end":{"line":26,"column":61}}],"line":26},"18":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":33}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":15}},{"start":{"line":26,"column":19},"end":{"line":26,"column":33}}],"line":26},"19":{"loc":{"start":{"line":68,"column":51},"end":{"line":68,"column":64}},"type":"default-arg","locations":[{"start":{"line":68,"column":59},"end":{"line":68,"column":64}}],"line":68},"20":{"loc":{"start":{"line":70,"column":4},"end":{"line":72,"column":5}},"type":"if","locations":[{"start":{"line":70,"column":4},"end":{"line":72,"column":5}},{"start":{},"end":{}}],"line":70},"21":{"loc":{"start":{"line":70,"column":8},"end":{"line":70,"column":38}},"type":"binary-expr","locations":[{"start":{"line":70,"column":8},"end":{"line":70,"column":19}},{"start":{"line":70,"column":23},"end":{"line":70,"column":38}}],"line":70},"22":{"loc":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},{"start":{},"end":{}}],"line":76},"23":{"loc":{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},{"start":{},"end":{}}],"line":91},"24":{"loc":{"start":{"line":111,"column":8},"end":{"line":114,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":114,"column":9}},{"start":{},"end":{}}],"line":111},"25":{"loc":{"start":{"line":111,"column":12},"end":{"line":111,"column":76}},"type":"binary-expr","locations":[{"start":{"line":111,"column":12},"end":{"line":111,"column":41}},{"start":{"line":111,"column":45},"end":{"line":111,"column":76}}],"line":111}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":302,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":60,"35":1,"36":2,"37":2,"38":0,"39":2,"40":2,"41":2,"42":12170,"43":2,"44":2,"45":2,"46":2,"47":60,"48":60,"49":0,"50":60,"51":60,"52":60,"53":60,"54":60,"55":60,"56":60,"57":60,"58":120,"59":60,"60":60,"61":60,"62":60,"63":60,"64":60,"65":1,"66":3,"67":3,"68":15,"69":1,"70":1},"f":{"0":119,"1":302,"2":0,"3":2,"4":0,"5":2,"6":1,"7":60,"8":2,"9":12170,"10":60,"11":120,"12":3,"13":15},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[1,1,1],"17":[1,0],"18":[1,1],"19":[0],"20":[0,2],"21":[2,0],"22":[2,0],"23":[0,60],"24":[60,0],"25":[60,60]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/item/baseItem.ts","sources":["/usr/src/app/src/models/item/baseItem.ts"],"names":[],"mappings":"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","sourcesContent":["import { HydratedDocument, model, Model, Schema } from 'mongoose';\nimport { AttributesModule, AttributesSchema } from '../user/attributes';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport ItemType from '../../enum/itemType';\n\n// Données du document\nexport interface IBaseItem {\n    name: string;\n    icon: string;\n    asset_men: string;\n    asset_women: string;\n    level: number;\n    type: string;\n    attributes: AttributesModule;\n}\n\n// Méthodes sur l'instance\ninterface IBaseItemMethods {\n    static: () => void;\n}\n\n// Méthodes statiques\ninterface IBaseItemModel extends Model<IBaseItem, object, IBaseItemMethods> {\n    populateDb(force: boolean, limit?: number): Promise<void>;\n    findByLevelAround(level: number): Promise<BaseItem[]>;\n}\n\nexport type BaseItem = HydratedDocument<IBaseItem, IBaseItemMethods>;\n\nexport const BaseItemSchema: Schema = new Schema<IBaseItem, object, IBaseItemMethods>(\n    {\n        name: {\n            type: String,\n            required: true,\n        },\n        icon: {\n            type: String,\n            required: true,\n        },\n        asset_men: {\n            type: String,\n            required: false,\n        },\n        asset_women: {\n            type: String,\n            required: false,\n        },\n        level: {\n            type: Number,\n            required: true,\n        },\n        type: {\n            type: String,\n            required: true,\n        },\n        attributes: {\n            type: AttributesSchema,\n            required: true,\n            default: () => ({}),\n        },\n    },\n    {\n        timestamps: true,\n    },\n);\n\nBaseItemSchema.statics.populateDb = async (force: boolean = false, limit?: number): Promise<void> => {\n    const hasItem = await BaseItemModel.countDocuments();\n\n    if (hasItem > 0 && force === false) {\n        return;\n    }\n\n    await BaseItemModel.deleteMany();\n\n    const files = fs.readdirSync('images/items');\n\n    let iconFiles = files.filter((f: string) => f.match(/_i.png/i));\n\n    if (limit) {\n        iconFiles = iconFiles.slice(0, limit);\n    }\n\n    const currentByItem: { [key: string]: number } = {\n        gadget: 0,\n        weapon: 0,\n        mask: 0,\n        suit: 0,\n        boots: 0,\n        sidekick: 0,\n        cape: 0,\n        belt: 0,\n    };\n\n    iconFiles.map(async (f: string) => {\n        const match = f.match(/^(?<type>.+?)_(?<name>.+)_i.png$/);\n\n        if (!match) {\n            return;\n        }\n\n        const type = match[1];\n        const slug = match[2];\n\n        const asset_path_women = path.join('images/items', `${type}_${slug}_f.png`);\n        const asset_path_men = path.join('images/items', `${type}_${slug}_m.png`);\n\n        const multiplier = 400 / ItemType.getByKey(type).total;\n\n        currentByItem[type] += 1;\n\n        const level = Math.round(multiplier * currentByItem[type]);\n\n        const label = slug\n            .replace(/_/g, ' ')\n            .replace(/([a-zA-Z])(\\d+)/g, '$1 $2')\n            .replace(/\\b\\w/g, (char) => char.toUpperCase());\n\n        const doc = new BaseItemModel({\n            icon: path.join('images/items', f),\n            name: label,\n            type: type,\n            level: level,\n        });\n\n        if (fs.existsSync(asset_path_men) && fs.existsSync(asset_path_women)) {\n            doc.asset_men = asset_path_men;\n            doc.asset_women = asset_path_women;\n        }\n\n        doc.attributes.distributePoints(level * 3);\n\n        await doc.save();\n    });\n};\n\n/**\n * Retourne 5 item aléatoire à -10 + 10 niveaux\n * @param level\n * @returns\n */\nBaseItemSchema.statics.findByLevelAround = async (level: number): Promise<BaseItem[]> => {\n    const agg = await BaseItemModel.aggregate([\n        { $match: { level: { $gte: level - 10, $lte: level + 10 } } },\n        { $sample: { size: 5 } },\n    ]).limit(5);\n\n    return agg.map((a) => new BaseItemModel(a));\n};\n\nconst BaseItemModel = model<IBaseItem, IBaseItemModel>('BaseItem', BaseItemSchema);\n\nexport { BaseItemModel };\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"98f76e0c64777554658b4fbb7d153fa336e39fce"},"/usr/src/app/src/enum/itemType.ts":{"path":"/usr/src/app/src/enum/itemType.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":23}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":25}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":27}},"4":{"start":{"line":8,"column":8},"end":{"line":8,"column":27}},"5":{"start":{"line":11,"column":18},"end":{"line":11,"column":59}},"6":{"start":{"line":11,"column":45},"end":{"line":11,"column":58}},"7":{"start":{"line":12,"column":8},"end":{"line":14,"column":9}},"8":{"start":{"line":13,"column":12},"end":{"line":13,"column":72}},"9":{"start":{"line":15,"column":8},"end":{"line":15,"column":17}},"10":{"start":{"line":18,"column":0},"end":{"line":27,"column":2}},"11":{"start":{"line":28,"column":0},"end":{"line":28,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":4},"end":{"line":4,"column":5}},"loc":{"start":{"line":4,"column":41},"end":{"line":9,"column":5}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":25},"end":{"line":16,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":38},"end":{"line":11,"column":39}},"loc":{"start":{"line":11,"column":45},"end":{"line":11,"column":58}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":8},"end":{"line":14,"column":9}},"type":"if","locations":[{"start":{"line":12,"column":8},"end":{"line":14,"column":9}},{"start":{},"end":{}}],"line":12}},"s":{"0":1,"1":8,"2":8,"3":8,"4":8,"5":60,"6":240,"7":60,"8":0,"9":60,"10":1,"11":1},"f":{"0":8,"1":60,"2":240},"b":{"0":[0,60]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/enum/itemType.ts","sources":["/usr/src/app/src/enum/itemType.ts"],"names":[],"mappings":";;AAAA,MAAqB,QAAQ;IAYzB,YACoB,GAAW,EACX,IAAY,EACZ,KAAa,EACb,KAAa;QAHb,QAAG,GAAH,GAAG,CAAQ;QACX,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAQ;QACb,UAAK,GAAL,KAAK,CAAQ;IAC9B,CAAC;IAEG,MAAM,CAAC,QAAQ,CAAC,GAAW;QAC9B,MAAM,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;QAEpD,IAAI,CAAC,KAAK,SAAS,EAAE,CAAC;YAClB,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,6BAA6B,CAAC,CAAC;QAChE,CAAC;QAED,OAAO,CAAC,CAAC;IACb,CAAC;;AA1Be,kBAAS,GAAG;IACxB,IAAI,QAAQ,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE,EAAE,GAAG,CAAC;IACvC,IAAI,QAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;IACrC,IAAI,QAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;IACrC,IAAI,QAAQ,CAAC,MAAM,EAAE,UAAU,EAAE,EAAE,EAAE,GAAG,CAAC;IACzC,IAAI,QAAQ,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,EAAE,GAAG,CAAC;IAC5C,IAAI,QAAQ,CAAC,QAAQ,EAAE,QAAQ,EAAE,EAAE,EAAE,GAAG,CAAC;IACzC,IAAI,QAAQ,CAAC,QAAQ,EAAE,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;IACvC,IAAI,QAAQ,CAAC,UAAU,EAAE,WAAW,EAAE,EAAE,EAAE,GAAG,CAAC;CACjD,CAAC;kBAVe,QAAQ","sourcesContent":["export default class ItemType {\n    static readonly ITEMTYPES = [\n        new ItemType('mask', 'Masque', '', 335),\n        new ItemType('cape', 'Cape', '', 319),\n        new ItemType('suit', 'Tenu', '', 494),\n        new ItemType('belt', 'Ceinture', '', 327),\n        new ItemType('boots', 'Chaussures', '', 286),\n        new ItemType('gadget', 'Gadget', '', 317),\n        new ItemType('weapon', 'Arme', '', 180),\n        new ItemType('sidekick', 'Compagnon', '', 172),\n    ];\n\n    private constructor(\n        public readonly key: string,\n        public readonly name: string,\n        public readonly emoji: string,\n        public readonly total: number,\n    ) {}\n\n    public static getByKey(key: string): ItemType {\n        const a = this.ITEMTYPES.find((a) => a.key === key);\n\n        if (a === undefined) {\n            throw new Error(`La clé ${key} n'existe pas dans ItemType`);\n        }\n\n        return a;\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0e00ad1a90c4641e83c151fb2ae13020bd0beda"},"/usr/src/app/src/models/user/stuff.ts":{"path":"/usr/src/app/src/models/user/stuff.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"2":{"start":{"line":4,"column":19},"end":{"line":4,"column":38}},"3":{"start":{"line":5,"column":15},"end":{"line":5,"column":38}},"4":{"start":{"line":6,"column":0},"end":{"line":39,"column":3}},"5":{"start":{"line":40,"column":0},"end":{"line":42,"column":2}},"6":{"start":{"line":41,"column":4},"end":{"line":41,"column":27}},"7":{"start":{"line":43,"column":0},"end":{"line":45,"column":2}},"8":{"start":{"line":44,"column":4},"end":{"line":44,"column":30}},"9":{"start":{"line":46,"column":0},"end":{"line":49,"column":2}},"10":{"start":{"line":47,"column":17},"end":{"line":47,"column":79}},"11":{"start":{"line":47,"column":60},"end":{"line":47,"column":78}},"12":{"start":{"line":48,"column":4},"end":{"line":48,"column":36}},"13":{"start":{"line":48,"column":27},"end":{"line":48,"column":34}},"14":{"start":{"line":50,"column":0},"end":{"line":56,"column":2}},"15":{"start":{"line":51,"column":17},"end":{"line":51,"column":79}},"16":{"start":{"line":51,"column":60},"end":{"line":51,"column":78}},"17":{"start":{"line":52,"column":26},"end":{"line":52,"column":93}},"18":{"start":{"line":52,"column":45},"end":{"line":52,"column":61}},"19":{"start":{"line":52,"column":74},"end":{"line":52,"column":92}},"20":{"start":{"line":53,"column":17},"end":{"line":53,"column":33}},"21":{"start":{"line":54,"column":4},"end":{"line":54,"column":26}},"22":{"start":{"line":55,"column":4},"end":{"line":55,"column":74}},"23":{"start":{"line":55,"column":50},"end":{"line":55,"column":66}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":40,"column":40},"end":{"line":40,"column":41}},"loc":{"start":{"line":40,"column":56},"end":{"line":42,"column":1}},"line":40},"1":{"name":"(anonymous_1)","decl":{"start":{"line":43,"column":44},"end":{"line":43,"column":45}},"loc":{"start":{"line":43,"column":60},"end":{"line":45,"column":1}},"line":43},"2":{"name":"(anonymous_2)","decl":{"start":{"line":46,"column":42},"end":{"line":46,"column":43}},"loc":{"start":{"line":46,"column":54},"end":{"line":49,"column":1}},"line":46},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":53},"end":{"line":47,"column":54}},"loc":{"start":{"line":47,"column":60},"end":{"line":47,"column":78}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":48,"column":20},"end":{"line":48,"column":21}},"loc":{"start":{"line":48,"column":27},"end":{"line":48,"column":34}},"line":48},"5":{"name":"(anonymous_5)","decl":{"start":{"line":50,"column":49},"end":{"line":50,"column":50}},"loc":{"start":{"line":50,"column":61},"end":{"line":56,"column":1}},"line":50},"6":{"name":"(anonymous_6)","decl":{"start":{"line":51,"column":53},"end":{"line":51,"column":54}},"loc":{"start":{"line":51,"column":60},"end":{"line":51,"column":78}},"line":51},"7":{"name":"(anonymous_7)","decl":{"start":{"line":52,"column":38},"end":{"line":52,"column":39}},"loc":{"start":{"line":52,"column":45},"end":{"line":52,"column":61}},"line":52},"8":{"name":"(anonymous_8)","decl":{"start":{"line":52,"column":67},"end":{"line":52,"column":68}},"loc":{"start":{"line":52,"column":74},"end":{"line":52,"column":92}},"line":52},"9":{"name":"(anonymous_9)","decl":{"start":{"line":55,"column":32},"end":{"line":55,"column":33}},"loc":{"start":{"line":55,"column":50},"end":{"line":55,"column":66}},"line":55}},"branchMap":{"0":{"loc":{"start":{"line":44,"column":11},"end":{"line":44,"column":29}},"type":"binary-expr","locations":[{"start":{"line":44,"column":11},"end":{"line":44,"column":21}},{"start":{"line":44,"column":25},"end":{"line":44,"column":29}}],"line":44}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":2,"9":1,"10":1,"11":9,"12":1,"13":8,"14":1,"15":1,"16":9,"17":1,"18":8,"19":1,"20":1,"21":1,"22":1,"23":0},"f":{"0":1,"1":2,"2":1,"3":9,"4":8,"5":1,"6":9,"7":8,"8":1,"9":0},"b":{"0":[2,1]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/user/stuff.ts","sources":["/usr/src/app/src/models/user/stuff.ts"],"names":[],"mappings":";;;AAAA,uCAAoD;AACpD,uCAAqD;AAyBxC,QAAA,WAAW,GAAW,IAAI,iBAAM,CAAgC;IACzE,MAAM,EAAE;QACJ,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,MAAM,EAAE;QACJ,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,KAAK,EAAE;QACH,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,QAAQ,EAAE;QACN,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;IACD,IAAI,EAAE;QACF,IAAI,EAAE,iBAAU;QAChB,OAAO,EAAE,IAAI;KAChB;CACJ,CAAC,CAAC;AAEH,mBAAW,CAAC,OAAO,CAAC,SAAS,GAAG,UAAU,IAAe;IACrD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;AAC3B,CAAC,CAAC;AAEF,mBAAW,CAAC,OAAO,CAAC,aAAa,GAAG,UAAU,IAAY;IACtD,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC;AAC9B,CAAC,CAAC;AAEF,mBAAW,CAAC,OAAO,CAAC,WAAW,GAAG;IAC9B,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC;IAC5E,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACpC,CAAC,CAAC;AAEF,mBAAW,CAAC,OAAO,CAAC,kBAAkB,GAAG;IACrC,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC;IAE5E,MAAM,aAAa,GAAuB,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC;IAE9G,MAAM,IAAI,GAAqB,aAAa,CAAC,CAAC,CAAC,CAAC;IAEhD,aAAa,CAAC,KAAK,EAAE,CAAC;IAEtB,OAAO,aAAa,CAAC,MAAM,CAAC,CAAC,GAAqB,EAAE,OAAyB,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;AAC9G,CAAC,CAAC","sourcesContent":["import { HydratedDocument, Schema } from 'mongoose';\nimport { ItemModel, ItemSchema } from '../item/item';\nimport { AttributesModule } from './attributes';\n\n// Données du document\ninterface IStuff {\n    gadget: ItemModel;\n    weapon: ItemModel;\n    mask: ItemModel;\n    suit: ItemModel;\n    boots: ItemModel;\n    sidekick: ItemModel;\n    cape: ItemModel;\n    belt: ItemModel;\n}\n\n// Méthodes sur l'instance\ninterface IStuffMethods {\n    equipItem(item: ItemModel): void;\n    getItemByType(type: string): ItemModel | null;\n    getTotalAttributes(): AttributesModule;\n    getAllItems(): ItemModel[];\n}\n\nexport type StuffModule = HydratedDocument<IStuff, IStuffMethods>;\n\nexport const StuffSchema: Schema = new Schema<IStuff, object, IStuffMethods>({\n    gadget: {\n        type: ItemSchema,\n        default: null,\n    },\n    weapon: {\n        type: ItemSchema,\n        default: null,\n    },\n    mask: {\n        type: ItemSchema,\n        default: null,\n    },\n    suit: {\n        type: ItemSchema,\n        default: null,\n    },\n    boots: {\n        type: ItemSchema,\n        default: null,\n    },\n    sidekick: {\n        type: ItemSchema,\n        default: null,\n    },\n    cape: {\n        type: ItemSchema,\n        default: null,\n    },\n    belt: {\n        type: ItemSchema,\n        default: null,\n    },\n});\n\nStuffSchema.methods.equipItem = function (item: ItemModel) {\n    this[item.type] = item;\n};\n\nStuffSchema.methods.getItemByType = function (type: string): ItemModel | null {\n    return this[type] ?? null;\n};\n\nStuffSchema.methods.getAllItems = function (): ItemModel[] {\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n    return keys.map((k) => this[k]);\n};\n\nStuffSchema.methods.getTotalAttributes = function (): AttributesModule {\n    const keys = Object.keys(this.toObject()).filter((s) => !s.startsWith('_'));\n\n    const allAttributes: AttributesModule[] = keys.filter((k) => this[k] !== null).map((k) => this[k].attributes);\n\n    const base: AttributesModule = allAttributes[0];\n\n    allAttributes.shift();\n\n    return allAttributes.reduce((acc: AttributesModule, current: AttributesModule) => current.add(acc), base);\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c4a736798edc726b93be8bba8e309382550a5fb8"},"/usr/src/app/src/models/item/shop.ts":{"path":"/usr/src/app/src/models/item/shop.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":28}},"4":{"start":{"line":7,"column":19},"end":{"line":7,"column":38}},"5":{"start":{"line":8,"column":15},"end":{"line":8,"column":32}},"6":{"start":{"line":9,"column":19},"end":{"line":9,"column":40}},"7":{"start":{"line":10,"column":17},"end":{"line":10,"column":62}},"8":{"start":{"line":11,"column":20},"end":{"line":11,"column":22}},"9":{"start":{"line":12,"column":0},"end":{"line":21,"column":3}},"10":{"start":{"line":22,"column":0},"end":{"line":30,"column":2}},"11":{"start":{"line":23,"column":24},"end":{"line":23,"column":34}},"12":{"start":{"line":24,"column":4},"end":{"line":24,"column":63}},"13":{"start":{"line":25,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":26,"column":8},"end":{"line":26,"column":39}},"15":{"start":{"line":27,"column":8},"end":{"line":27,"column":26}},"16":{"start":{"line":29,"column":4},"end":{"line":29,"column":22}},"17":{"start":{"line":31,"column":0},"end":{"line":43,"column":2}},"18":{"start":{"line":32,"column":4},"end":{"line":32,"column":34}},"19":{"start":{"line":33,"column":22},"end":{"line":33,"column":93}},"20":{"start":{"line":34,"column":4},"end":{"line":42,"column":7}},"21":{"start":{"line":35,"column":23},"end":{"line":35,"column":51}},"22":{"start":{"line":36,"column":8},"end":{"line":36,"column":48}},"23":{"start":{"line":37,"column":8},"end":{"line":41,"column":10}},"24":{"start":{"line":44,"column":0},"end":{"line":53,"column":2}},"25":{"start":{"line":45,"column":16},"end":{"line":45,"column":26}},"26":{"start":{"line":46,"column":17},"end":{"line":46,"column":59}},"27":{"start":{"line":47,"column":20},"end":{"line":47,"column":50}},"28":{"start":{"line":48,"column":29},"end":{"line":48,"column":55}},"29":{"start":{"line":49,"column":16},"end":{"line":51,"column":30}},"30":{"start":{"line":52,"column":4},"end":{"line":52,"column":15}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":22,"column":38},"end":{"line":22,"column":39}},"loc":{"start":{"line":22,"column":60},"end":{"line":30,"column":1}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":43},"end":{"line":31,"column":44}},"loc":{"start":{"line":31,"column":65},"end":{"line":43,"column":1}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":31},"end":{"line":34,"column":32}},"loc":{"start":{"line":34,"column":45},"end":{"line":42,"column":5}},"line":34},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":46},"end":{"line":44,"column":47}},"loc":{"start":{"line":44,"column":58},"end":{"line":53,"column":1}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":25,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":28,"column":5}},{"start":{},"end":{}}],"line":25},"4":{"loc":{"start":{"line":25,"column":8},"end":{"line":25,"column":72}},"type":"binary-expr","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":38}},{"start":{"line":25,"column":42},"end":{"line":25,"column":72}}],"line":25}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":4,"12":4,"13":4,"14":2,"15":2,"16":4,"17":1,"18":2,"19":2,"20":2,"21":10,"22":10,"23":10,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"f":{"0":1,"1":4,"2":2,"3":10,"4":0},"b":{"0":[1,1,1],"1":[1,0],"2":[1,1],"3":[2,2],"4":[4,2]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/models/item/shop.ts","sources":["/usr/src/app/src/models/item/shop.ts"],"names":[],"mappings":";;;;;;AAAA,uCAAoD;AACpD,iCAA+C;AAC/C,yCAAqD;AAErD,+DAAuC;AAGvC,MAAM,WAAW,GAAG,EAAE,CAAC;AAgBV,QAAA,UAAU,GAAW,IAAI,iBAAM,CAA8B;IACtE,WAAW,EAAE;QACT,IAAI,EAAE,IAAI;KACb;IACD,KAAK,EAAE;QACH,IAAI,EAAE,CAAC,iBAAU,CAAC;QAClB,QAAQ,EAAE,IAAI;QACd,OAAO,EAAE,EAAE;KACd;CACJ,CAAC,CAAC;AAEH,kBAAU,CAAC,OAAO,CAAC,QAAQ,GAAG,KAAK,WAAW,IAAU;IACpD,MAAM,WAAW,GAAG,IAAI,IAAI,EAAE,CAAC;IAC/B,WAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,EAAE,GAAG,WAAW,CAAC,CAAC;IAE3D,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,IAAI,IAAI,CAAC,WAAW,GAAG,WAAW,EAAE,CAAC;QACnE,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAC/B,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;IACtB,CAAC;IAED,OAAO,IAAI,CAAC,KAAK,CAAC;AACtB,CAAC,CAAC;AAEF,kBAAU,CAAC,OAAO,CAAC,aAAa,GAAG,KAAK,WAAW,IAAU;IACzD,IAAI,CAAC,WAAW,GAAG,IAAI,IAAI,EAAE,CAAC;IAE9B,MAAM,SAAS,GAAG,MAAM,wBAAa,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;IAE/E,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,QAAkB,EAAE,EAAE;QAC9C,MAAM,MAAM,GAAW,gBAAM,CAAC,SAAS,EAAE,CAAC;QAE1C,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAExC,OAAO;YACH,GAAG,QAAQ;YACX,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC;YACrD,MAAM,EAAE,MAAM,CAAC,GAAG;SACrB,CAAC;IACN,CAAC,CAAC,CAAC;AACP,CAAC,CAAC;AAEF,kBAAU,CAAC,OAAO,CAAC,gBAAgB,GAAG;IAClC,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;IACvB,MAAM,IAAI,GAAG,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;IAExD,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;IAC/C,MAAM,gBAAgB,GAAG,WAAW,GAAG,EAAE,GAAG,OAAO,CAAC;IAEpD,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,EAAE,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,EAAE,CAAC;SAChF,QAAQ,EAAE;SACV,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC;IAC3B,OAAO,GAAG,CAAC;AACf,CAAC,CAAC","sourcesContent":["import { HydratedDocument, Schema } from 'mongoose';\nimport { ItemModel, ItemSchema } from './item';\nimport { BaseItem, BaseItemModel } from './baseItem';\nimport { User } from '../user/user';\nimport Rarity from '../../enum/rarity';\n\n// Temps de recharge en heure\nconst RELOAD_TIME = 12;\n\ninterface IShop {\n    generatedAt: Date;\n    items: ItemModel[];\n}\n\n// Méthodes sur l'instance\ninterface IShopMethods {\n    getItems(user: User): Promise<ItemModel[]>;\n    generateItems(user: User): Promise<void>;\n    getRemainingTime(): string;\n}\n\nexport type ShopModule = HydratedDocument<IShop, IShopMethods>;\n\nexport const ShopSchema: Schema = new Schema<IShop, object, IShopMethods>({\n    generatedAt: {\n        type: Date,\n    },\n    items: {\n        type: [ItemSchema],\n        required: true,\n        default: [],\n    },\n});\n\nShopSchema.methods.getItems = async function (user: User): Promise<ItemModel[]> {\n    const currentDate = new Date();\n    currentDate.setHours(currentDate.getHours() - RELOAD_TIME);\n\n    if (this.generatedAt === undefined || this.generatedAt < currentDate) {\n        await this.generateItems(user);\n        await user.save();\n    }\n\n    return this.items;\n};\n\nShopSchema.methods.generateItems = async function (user: User) {\n    this.generatedAt = new Date();\n\n    const baseItems = await BaseItemModel.findByLevelAround(user.experience.level);\n\n    this.items = baseItems.map((baseItem: BaseItem) => {\n        const rarity: Rarity = Rarity.getRandom();\n\n        baseItem.attributes.applyRarity(rarity);\n\n        return {\n            ...baseItem,\n            price: Math.round(baseItem.level * rarity.multiplier),\n            rarity: rarity.key,\n        };\n    });\n};\n\nShopSchema.methods.getRemainingTime = function (): string {\n    const now = new Date();\n    const diff = now.getTime() - this.generatedAt.getTime();\n\n    const diffMin = Math.floor(diff / (1000 * 60));\n    const remainingTimeMin = RELOAD_TIME * 60 - diffMin;\n\n    const res = `${Math.floor(remainingTimeMin / 60)}h${Math.floor(remainingTimeMin % 60)\n        .toString()\n        .padStart(2, '0')}min`;\n    return res;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"297d5fcb6cd571b2214fdfdb6be5377c1410547e"},"/usr/src/app/src/enum/rarity.ts":{"path":"/usr/src/app/src/enum/rarity.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":23}},"2":{"start":{"line":6,"column":8},"end":{"line":6,"column":25}},"3":{"start":{"line":7,"column":8},"end":{"line":7,"column":27}},"4":{"start":{"line":8,"column":8},"end":{"line":8,"column":37}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":33}},"6":{"start":{"line":12,"column":24},"end":{"line":12,"column":105}},"7":{"start":{"line":12,"column":67},"end":{"line":12,"column":103}},"8":{"start":{"line":13,"column":8},"end":{"line":13,"column":67}},"9":{"start":{"line":16,"column":18},"end":{"line":16,"column":58}},"10":{"start":{"line":16,"column":44},"end":{"line":16,"column":57}},"11":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"12":{"start":{"line":18,"column":12},"end":{"line":18,"column":70}},"13":{"start":{"line":20,"column":8},"end":{"line":20,"column":17}},"14":{"start":{"line":23,"column":0},"end":{"line":32,"column":2}},"15":{"start":{"line":33,"column":0},"end":{"line":33,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":4,"column":4},"end":{"line":4,"column":5}},"loc":{"start":{"line":4,"column":56},"end":{"line":10,"column":5}},"line":4},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":4},"end":{"line":11,"column":5}},"loc":{"start":{"line":11,"column":23},"end":{"line":14,"column":5}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":12,"column":60},"end":{"line":12,"column":61}},"loc":{"start":{"line":12,"column":67},"end":{"line":12,"column":103}},"line":12},"3":{"name":"(anonymous_3)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":25},"end":{"line":21,"column":5}},"line":15},"4":{"name":"(anonymous_4)","decl":{"start":{"line":16,"column":37},"end":{"line":16,"column":38}},"loc":{"start":{"line":16,"column":44},"end":{"line":16,"column":57}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},{"start":{},"end":{}}],"line":17}},"s":{"0":1,"1":8,"2":8,"3":8,"4":8,"5":8,"6":10,"7":80,"8":10,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1,"15":1},"f":{"0":8,"1":10,"2":80,"3":0,"4":0},"b":{"0":[0,0]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/enum/rarity.ts","sources":["/usr/src/app/src/enum/rarity.ts"],"names":[],"mappings":";;AAEA,MAAqB,MAAM;IAYvB,YACoB,GAAW,EACX,IAAY,EACZ,KAAsB,EACtB,UAAkB,EAClB,QAAgB;QAJhB,QAAG,GAAH,GAAG,CAAQ;QACX,SAAI,GAAJ,IAAI,CAAQ;QACZ,UAAK,GAAL,KAAK,CAAiB;QACtB,eAAU,GAAV,UAAU,CAAQ;QAClB,aAAQ,GAAR,QAAQ,CAAQ;IACjC,CAAC;IAEG,MAAM,CAAC,SAAS;QACnB,MAAM,OAAO,GAAG,KAAK,EAAU,CAAC,MAAM,CAClC,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAS,EAAE,EAAE,CAAC,KAAK,CAAS,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CACpF,CAAC;QAEF,OAAO,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;IAC/D,CAAC;IAEM,MAAM,CAAC,QAAQ,CAAC,GAAW;QAC9B,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;QAEnD,IAAI,CAAC,KAAK,SAAS,EAAE,CAAC;YAClB,MAAM,IAAI,KAAK,CAAC,UAAU,GAAG,2BAA2B,CAAC,CAAC;QAC9D,CAAC;QAED,OAAO,CAAC,CAAC;IACb,CAAC;;AAnCe,eAAQ,GAAG;IACvB,IAAI,MAAM,CAAC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE,CAAC;IAChD,IAAI,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,EAAE,EAAE,CAAC;IAChD,IAAI,MAAM,CAAC,UAAU,EAAE,YAAY,EAAE,WAAW,EAAE,GAAG,EAAE,EAAE,CAAC;IAC1D,IAAI,MAAM,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;IAC1C,IAAI,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC;IAC5C,IAAI,MAAM,CAAC,WAAW,EAAE,YAAY,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,CAAC;IACvD,IAAI,MAAM,CAAC,UAAU,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,EAAE,IAAI,CAAC;IACpD,IAAI,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,CAAC,EAAE,IAAI,CAAC;CAC3D,CAAC;kBAVe,MAAM","sourcesContent":["import { ColorResolvable } from 'discord.js';\n\nexport default class Rarity {\n    static readonly RARITIES = [\n        new Rarity('POOR', 'Médiocre', 'Default', 1, 50),\n        new Rarity('COMMON', 'Commun', 'Green', 1.2, 30),\n        new Rarity('UNCOMMON', 'Peu commun', 'DarkGreen', 1.4, 10),\n        new Rarity('RARE', 'Rare', 'Blue', 1.7, 5),\n        new Rarity('EPIC', 'Epique', 'Purple', 2, 3),\n        new Rarity('LEGENDARY', 'Légendaire', 'Gold', 2.3, 1.5),\n        new Rarity('ULTIMATE', 'Ultime', 'White', 2.6, 0.05),\n        new Rarity('DIVINE', 'Divine', 'NotQuiteBlack', 3, 0.05),\n    ];\n\n    private constructor(\n        public readonly key: string,\n        public readonly name: string,\n        public readonly color: ColorResolvable,\n        public readonly multiplier: number,\n        public readonly dropRate: number,\n    ) {}\n\n    public static getRandom(): Rarity {\n        const weights = Array<Rarity>().concat(\n            ...this.RARITIES.map((r: Rarity) => Array<Rarity>(Math.ceil(r.dropRate)).fill(r)),\n        );\n\n        return weights[Math.floor(Math.random() * weights.length)];\n    }\n\n    public static getByKey(key: string): Rarity {\n        const r = this.RARITIES.find((r) => r.key === key);\n\n        if (r === undefined) {\n            throw new Error(`La clé ${key} n'existe pas dans Rarity`);\n        }\n\n        return r;\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9353ce9448354ddca229bc5cabc4a19ecf6f540a"},"/usr/src/app/src/libs/montage/StuffMontage.ts":{"path":"/usr/src/app/src/libs/montage/StuffMontage.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"2":{"start":{"line":3,"column":26},"end":{"line":3,"column":33}},"3":{"start":{"line":4,"column":15},"end":{"line":4,"column":52}},"4":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"5":{"start":{"line":6,"column":6},"end":{"line":6,"column":68}},"6":{"start":{"line":6,"column":51},"end":{"line":6,"column":63}},"7":{"start":{"line":8,"column":4},"end":{"line":8,"column":39}},"8":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"9":{"start":{"line":10,"column":26},"end":{"line":10,"column":33}},"10":{"start":{"line":11,"column":4},"end":{"line":11,"column":17}},"11":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":21}},"14":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"16":{"start":{"line":19,"column":31},"end":{"line":19,"column":42}},"17":{"start":{"line":20,"column":17},"end":{"line":20,"column":19}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"19":{"start":{"line":21,"column":21},"end":{"line":21,"column":141}},"20":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"21":{"start":{"line":21,"column":109},"end":{"line":21,"column":141}},"22":{"start":{"line":22,"column":4},"end":{"line":22,"column":36}},"23":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"24":{"start":{"line":25,"column":0},"end":{"line":25,"column":62}},"25":{"start":{"line":26,"column":11},"end":{"line":26,"column":38}},"26":{"start":{"line":27,"column":13},"end":{"line":27,"column":42}},"27":{"start":{"line":28,"column":17},"end":{"line":28,"column":34}},"28":{"start":{"line":29,"column":15},"end":{"line":29,"column":48}},"29":{"start":{"line":32,"column":26},"end":{"line":32,"column":54}},"30":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"31":{"start":{"line":34,"column":12},"end":{"line":34,"column":29}},"32":{"start":{"line":36,"column":8},"end":{"line":36,"column":39}},"33":{"start":{"line":37,"column":8},"end":{"line":37,"column":25}},"34":{"start":{"line":40,"column":23},"end":{"line":40,"column":59}},"35":{"start":{"line":41,"column":20},"end":{"line":41,"column":43}},"36":{"start":{"line":42,"column":25},"end":{"line":42,"column":51}},"37":{"start":{"line":43,"column":26},"end":{"line":43,"column":65}},"38":{"start":{"line":44,"column":8},"end":{"line":44,"column":39}},"39":{"start":{"line":45,"column":22},"end":{"line":45,"column":46}},"40":{"start":{"line":46,"column":8},"end":{"line":61,"column":12}},"41":{"start":{"line":47,"column":12},"end":{"line":49,"column":13}},"42":{"start":{"line":48,"column":16},"end":{"line":48,"column":23}},"43":{"start":{"line":50,"column":27},"end":{"line":50,"column":41}},"44":{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},"45":{"start":{"line":52,"column":16},"end":{"line":52,"column":44}},"46":{"start":{"line":54,"column":30},"end":{"line":54,"column":69}},"47":{"start":{"line":55,"column":12},"end":{"line":60,"column":13}},"48":{"start":{"line":56,"column":16},"end":{"line":56,"column":63}},"49":{"start":{"line":59,"column":16},"end":{"line":59,"column":63}},"50":{"start":{"line":62,"column":23},"end":{"line":62,"column":51}},"51":{"start":{"line":63,"column":8},"end":{"line":63,"column":63}},"52":{"start":{"line":66,"column":8},"end":{"line":66,"column":59}},"53":{"start":{"line":69,"column":0},"end":{"line":69,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":74},"end":{"line":2,"column":75}},"loc":{"start":{"line":2,"column":96},"end":{"line":9,"column":1}},"line":2},"1":{"name":"(anonymous_1)","decl":{"start":{"line":6,"column":38},"end":{"line":6,"column":39}},"loc":{"start":{"line":6,"column":49},"end":{"line":6,"column":65}},"line":6},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":6},"end":{"line":9,"column":7}},"loc":{"start":{"line":9,"column":28},"end":{"line":12,"column":1}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":13,"column":80},"end":{"line":13,"column":81}},"loc":{"start":{"line":13,"column":95},"end":{"line":15,"column":1}},"line":13},"4":{"name":"(anonymous_4)","decl":{"start":{"line":15,"column":5},"end":{"line":15,"column":6}},"loc":{"start":{"line":15,"column":20},"end":{"line":17,"column":1}},"line":15},"5":{"name":"(anonymous_5)","decl":{"start":{"line":18,"column":50},"end":{"line":18,"column":51}},"loc":{"start":{"line":18,"column":65},"end":{"line":24,"column":1}},"line":18},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":32},"end":{"line":38,"column":5}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":37},"end":{"line":64,"column":5}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":46,"column":36},"end":{"line":46,"column":37}},"loc":{"start":{"line":46,"column":52},"end":{"line":61,"column":9}},"line":46},"9":{"name":"(anonymous_9)","decl":{"start":{"line":65,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":65,"column":35},"end":{"line":67,"column":5}},"line":65}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":12,"column":3}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":57},"end":{"line":12,"column":2}}],"line":2},"1":{"loc":{"start":{"line":2,"column":57},"end":{"line":12,"column":2}},"type":"cond-expr","locations":[{"start":{"line":2,"column":74},"end":{"line":9,"column":1}},{"start":{"line":9,"column":6},"end":{"line":12,"column":1}}],"line":2},"2":{"loc":{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},"type":"if","locations":[{"start":{"line":3,"column":4},"end":{"line":3,"column":33}},{"start":{},"end":{}}],"line":3},"3":{"loc":{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},"type":"if","locations":[{"start":{"line":5,"column":4},"end":{"line":7,"column":5}},{"start":{},"end":{}}],"line":5},"4":{"loc":{"start":{"line":5,"column":8},"end":{"line":5,"column":85}},"type":"binary-expr","locations":[{"start":{"line":5,"column":8},"end":{"line":5,"column":13}},{"start":{"line":5,"column":18},"end":{"line":5,"column":84}}],"line":5},"5":{"loc":{"start":{"line":5,"column":18},"end":{"line":5,"column":84}},"type":"cond-expr","locations":[{"start":{"line":5,"column":34},"end":{"line":5,"column":47}},{"start":{"line":5,"column":50},"end":{"line":5,"column":84}}],"line":5},"6":{"loc":{"start":{"line":5,"column":50},"end":{"line":5,"column":84}},"type":"binary-expr","locations":[{"start":{"line":5,"column":50},"end":{"line":5,"column":63}},{"start":{"line":5,"column":67},"end":{"line":5,"column":84}}],"line":5},"7":{"loc":{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":10,"column":33}},{"start":{},"end":{}}],"line":10},"8":{"loc":{"start":{"line":13,"column":25},"end":{"line":17,"column":2}},"type":"binary-expr","locations":[{"start":{"line":13,"column":26},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":57}},{"start":{"line":13,"column":63},"end":{"line":17,"column":1}}],"line":13},"9":{"loc":{"start":{"line":13,"column":63},"end":{"line":17,"column":1}},"type":"cond-expr","locations":[{"start":{"line":13,"column":80},"end":{"line":15,"column":1}},{"start":{"line":15,"column":5},"end":{"line":17,"column":1}}],"line":13},"10":{"loc":{"start":{"line":18,"column":19},"end":{"line":24,"column":1}},"type":"binary-expr","locations":[{"start":{"line":18,"column":20},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":45}},{"start":{"line":18,"column":50},"end":{"line":24,"column":1}}],"line":18},"11":{"loc":{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":19,"column":42}},{"start":{},"end":{}}],"line":19},"12":{"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"type":"binary-expr","locations":[{"start":{"line":19,"column":8},"end":{"line":19,"column":11}},{"start":{"line":19,"column":15},"end":{"line":19,"column":29}}],"line":19},"13":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"14":{"loc":{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},"type":"if","locations":[{"start":{"line":21,"column":40},"end":{"line":21,"column":141}},{"start":{},"end":{}}],"line":21},"15":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":107}},"type":"binary-expr","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":59}},{"start":{"line":21,"column":63},"end":{"line":21,"column":107}}],"line":21},"16":{"loc":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},{"start":{},"end":{}}],"line":33},"17":{"loc":{"start":{"line":47,"column":12},"end":{"line":49,"column":13}},"type":"if","locations":[{"start":{"line":47,"column":12},"end":{"line":49,"column":13}},{"start":{},"end":{}}],"line":47},"18":{"loc":{"start":{"line":47,"column":16},"end":{"line":47,"column":61}},"type":"binary-expr","locations":[{"start":{"line":47,"column":16},"end":{"line":47,"column":29}},{"start":{"line":47,"column":33},"end":{"line":47,"column":61}}],"line":47},"19":{"loc":{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},"type":"if","locations":[{"start":{"line":51,"column":12},"end":{"line":53,"column":13}},{"start":{},"end":{}}],"line":51},"20":{"loc":{"start":{"line":55,"column":12},"end":{"line":60,"column":13}},"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":60,"column":13}},{"start":{"line":58,"column":17},"end":{"line":60,"column":13}}],"line":55}},"s":{"0":1,"1":119,"2":119,"3":119,"4":119,"5":114,"6":4,"7":119,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":2,"16":0,"17":2,"18":2,"19":2,"20":119,"21":119,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":0,"33":0,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":8,"42":7,"43":1,"44":1,"45":0,"46":1,"47":1,"48":1,"49":0,"50":1,"51":1,"52":2,"53":1},"f":{"0":119,"1":4,"2":0,"3":2,"4":0,"5":2,"6":1,"7":1,"8":8,"9":2},"b":{"0":[1,1,1],"1":[1,0],"2":[119,0],"3":[114,5],"4":[119,119],"5":[5,114],"6":[114,5],"7":[0,0],"8":[1,1,1],"9":[1,0],"10":[1,1,1],"11":[0,2],"12":[2,2],"13":[2,0],"14":[119,0],"15":[119,119],"16":[1,0],"17":[7,1],"18":[8,1],"19":[0,1],"20":[1,0]},"inputSourceMap":{"version":3,"file":"/usr/src/app/src/libs/montage/StuffMontage.ts","sources":["/usr/src/app/src/libs/montage/StuffMontage.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AACA,uCAAyB;AACzB,2CAA6B;AAC7B,mCAAiD;AACjD,iDAAgD;AAEhD,MAAqB,YAAY;IACtB,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAU;QACnC,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAE/C,IAAI,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;YAC3B,OAAO,SAAS,CAAC;QACrB,CAAC;QAED,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAE/B,OAAO,SAAS,CAAC;IACrB,CAAC;IAKM,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,IAAU;QACxC,MAAM,MAAM,GAAG,IAAA,qBAAY,EAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACtC,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAEpC,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC5C,MAAM,SAAS,GAAG,MAAM,IAAA,kBAAS,EAAC,QAAQ,CAAC,CAAC;QAE5C,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAE/B,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;QAEvC,MAAM,OAAO,CAAC,GAAG,CACb,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YACrB,IAAI,IAAI,KAAK,IAAI,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS,EAAE,CAAC;gBAChD,OAAO;YACX,CAAC;YAED,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;YAE9B,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,aAAM,CAAC,KAAK,EAAE,CAAC;gBACpC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC;YAChC,CAAC;YAED,MAAM,SAAS,GAAG,MAAM,IAAA,kBAAS,EAAC,QAAQ,CAAC,CAAC;YAE5C,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,aAAM,CAAC,GAAG,EAAE,CAAC;gBAClC,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;YACnD,CAAC;iBAAM,CAAC;gBACJ,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;YACnD,CAAC;QACL,CAAC,CAAC,CACL,CAAC;QAGF,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAC5C,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC;IAC3D,CAAC;IAKO,MAAM,CAAC,iBAAiB,CAAC,IAAU;QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC;IACvD,CAAC;CACJ;AA5DD,+BA4DC","sourcesContent":["import { User } from '../../models/user/user';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { createCanvas, loadImage } from 'canvas';\nimport { Gender } from '../../models/user/skin';\n\nexport default class StuffMontage {\n    public static async getImage(user: User): Promise<string> {\n        const imagePath = this.getStuffImagePath(user);\n\n        if (fs.existsSync(imagePath)) {\n            return imagePath;\n        }\n\n        await this.generateImage(user);\n\n        return imagePath;\n    }\n\n    /**\n     * Génère une image en fonction d'un skin\n     */\n    public static async generateImage(user: User): Promise<void> {\n        const canvas = createCanvas(350, 900);\n        const ctx = canvas.getContext('2d');\n\n        const skinPath = await user.skin.getImage();\n        const skinImage = await loadImage(skinPath);\n\n        ctx.drawImage(skinImage, 0, 0);\n\n        const items = user.stuff.getAllItems();\n\n        await Promise.all(\n            items.map(async (item) => {\n                if (item === null || item.asset_men === undefined) {\n                    return;\n                }\n\n                let itemPath = item.asset_men;\n\n                if (user.skin.gender === Gender.Women) {\n                    itemPath = item.asset_women;\n                }\n\n                const itemImage = await loadImage(itemPath);\n\n                if (user.skin.gender === Gender.Men) {\n                    ctx.drawImage(itemImage, -201, -35, 683, 1010);\n                } else {\n                    ctx.drawImage(itemImage, -205, -12, 687, 1010);\n                }\n            }),\n        );\n\n        // Génération de l'image\n        const buffer = canvas.toBuffer('image/png');\n        fs.writeFileSync(this.getStuffImagePath(user), buffer);\n    }\n\n    /**\n     * Retourne le chemin de l'image en fonction du skin\n     */\n    private static getStuffImagePath(user: User) {\n        return path.join('public/stuff', user.id + '.png');\n    }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b8cf833111eb92a77dde7da57f2bc9c7355c74a8"}}